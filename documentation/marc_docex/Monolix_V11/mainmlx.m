function varargout = mainmlx(varargin)
%MAINMLX  main program called by MONOLIX

%  Marc Lavielle
%  Version 1.1 ;  2005/02/18

%This program is free software; you can redistribute it and/or modify it
%under the terms of the GNU General Public License as published by the Free
%Software Foundation; either version 2 of the License, or (at your option)
%any later version.
%This program is distributed in the hope that it will be useful, but
%WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
%or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
%for more details (http://www.gnu.org/copyleft/gpl.html).

% Last Modified by GUIDE v2.5 12-Feb-2005 22:20:52

% Begin initialization code - DO NOT EDIT

gui_Singleton = 1;
gui_State = struct('gui_Name',       mfilename, ...
    'gui_Singleton',  gui_Singleton, ...
    'gui_OpeningFcn', @mainmlx_OpeningFcn, ...
    'gui_OutputFcn',  @mainmlx_OutputFcn, ...
    'gui_LayoutFcn',  @mainmlx_LayoutFcn, ...
    'gui_Callback',   []);
if nargin & isstr(varargin{1})
    gui_State.gui_Callback = str2func(varargin{1});
end

if nargout
    [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
else
    gui_mainfcn(gui_State, varargin{:});
end
% End initialization code - DO NOT EDIT

% --- Executes just before mainmlx is made visible.
function mainmlx_OpeningFcn(hObject, eventdata, handles, varargin)
% Choose default command line output for mainmlx
handles.output = hObject;
% Update handles structure
guidata(hObject, handles);


ngraf=9;
hf=zeros(ngraf,1);
hf(1)=figure('name',' The data','visible','off');
hf(2)=figure('name',' Estimation of the parameters','visible','off');
for k=3:ngraf
    hf(k)=figure('visible','off');
end;
addmenumlx(hf);
handles.fig=hf;

% Update handles structure
guidata(hObject, handles);
% --- Outputs from this function are returned to the command line.
function varargout = mainmlx_OutputFcn(hObject, eventdata, handles)
% varargout  cell array for returning output args (see VARARGOUT);
% Get default command line output from handles structure
varargout{1} = handles.output;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_dispdata_Callback(hObject, eventdata, handles)
hf1=figure('name',' The data','position',[0.2 0.3 0.6 0.6]);
handles.fig(1)=hf1;
% ifig=intersect(findobj,handles.fig);
% set(ifig,'visible','off')
s=reactual(handles);
eval(['S=load(''',s.donnees,''');'])
nb_varex=s.nb_varex;
N_mesures=size(S,1);
y=S(:,nb_varex+2);
id=S(:,1);
design=S(:,2:nb_varex+1);
M=[id design  y];

if nb_varex>1
    str1=[];
    str2='none ';
    for k=1:nb_varex
        str1=[str1;'var ' num2str(k)];
        str2=[str2;'var ' num2str(k)];
    end;
    clbk=['h=get(gco,''userdata'');  mainmlx(''graf_data'',gco,[],h);  '];
    P01=[0.005  0.8 0.08  0.05];
    P1=[0.005  P01(2)-0.03*nb_varex  0.08  0.03*nb_varex];
    P02=[0.005  P1(2)-0.2 0.08  0.05];
    P2=[0.005  P02(2)-0.03*(nb_varex+1)  0.08  0.03*(nb_varex+1)];
    P=P02;
    P(2)=.1;
    h01=uicontrol('unit','normalized','style','text','string','regression variable','position',P01,'fontsize',8);
    h1=uicontrol('unit','normalized','style','listbox','string',str1,'position',P1,'callback',clbk);
    h02=uicontrol('unit','normalized','style','text','string','categorical variable','position',P02,'fontsize',8);
    h2=uicontrol('unit','normalized','style','listbox','string',str2,'position',P2,'callback',clbk);
    set([h1, h2],'userdata',[hf1 h1 h2])
     set([h1, h2 h01 h02],'FontUnits','normalized')
   strclk='hfig=get(gco,''userdata''); close(hfig);';
    hcl=uicontrol('style','pushbutton','units','normalized','string','Close','callback',strclk);
    set(hcl,'BackgroundColor',[0.588 0.796 0.796],'Fontweight','bold','Fontsize',9,'position',P);
    set(hcl,'userdata',[hf1 ]);
else
    h1=uicontrol('style','listbox','value',1,'visible','off');
    h2=uicontrol('style','listbox','value',1,'visible','off');
end;
figure(hf1);
addmenumlx(hf1);
set(hf1,'userdata',M);
eval('mainmlx(''graf_data'',gcbo,[],[hf1 h1 h2])');

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function graf_data(hObject, eventdata, h)
hf=h(1);
figure(hf);
h1=h(2);
h2=h(3);
M=get(hf,'userdata');
if size(M,2)>3
    nvar=get(h1,'value');
    ncat=get(h2,'value')-1;
else
    nvar=1;
    ncat=0;
end;
NM=size(M,1);
if ncat==0
    xcat=ones(NM,1);
else
    xcat=M(:,ncat+1);
end;
S=[M(:,1) M(:,nvar+1)  M(:,end)];

ucat=unique(xcat);
lcat=length(ucat);
n1=fix(sqrt(lcat));
n2=ceil(lcat/n1);
subplot(1,1,1)
for k=1:lcat
    ik=find(xcat==ucat(k));
    Sk=S(ik,:);
    Sk=sortrows(Sk,1);
    id=Sk(:,1);
    idu=unique(id);
    nk=length(idu);
    nb_measures=zeros(nk,1);
    for i=1:nk;
        nb_measures(i)=sum(id==idu(i));
    end;
    nb_design=max(nb_measures);
    y=zeros(nk,nb_design);
    design=zeros(nk,nb_design);
    i1=1;
    subplot(n1,n2,k)
    for i=1:nk;
        nbi=nb_measures(i);
        i2=i1+nbi-1;
        designki=Sk(i1:i2,2)';
        yki=Sk(i1:i2,3)';
        i1=i2+1;
        plot(designki,yki,'o-');
        hold on
    end;
    hold off
    title(num2str(ucat(k)))
end;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_estimate_Callback(hObject,eventdata, handles)
s=reactual(handles);
c1=get(handles.pushbutton_save,'backgroundcolor');
%st=get(handles.pushbutton_estimate,'string');
st='Parameters';
set(handles.pushbutton_estimate,'string','WAIT ...','backgroundcolor','red');
pause(1)
hf2=handles.fig(2);
disp('******************************************************************')
disp('                      PARAMETER ESTIMATION:')
disp(' ')
saemmlx(s,hf2);
set(handles.pushbutton_estimate,'string',st,'backgroundcolor',c1);
set(handles.pushbutton_likelihood,'visible','on')
set(handles.frame3,'visible','on')
set(handles.text_test,'visible','on')
set(handles.pushbutton_test1,'visible','on')
set(handles.pushbutton_test2,'visible','on')
set(handles.frame8,'visible','on')
set(handles.text_results,'visible','on')
set(handles.pushbutton_results,'visible','on')
set(handles.frame13,'visible','on')
set(handles.text_simul,'visible','on')
set(handles.pushbutton_simul,'visible','on')

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_likelihood_Callback(hObject, eventdata, handles)
c1=get(handles.pushbutton_save,'backgroundcolor');
set(handles.pushbutton_likelihood,'string','WAIT ...','backgroundcolor','red');
pause(1)
s=reactual(handles);
eval(['load(''',s.resultats,''');']);
s.Klog=str2num(get(handles.edit_like,'string'));
logl=lvraismlx(s);
%logl=lvraismlx(fonction,y,design,nb_measures,id,indio,mprior_phi1,Gamma2_phi1,sigma2,mpost_phi,vpost_phi,i1,i0,Klog);
logl=real(logl);
disp(' ')
fprintf('  estimated log-likelihood: %0.5g\n',logl)
set(handles.pushbutton_likelihood,'string','Likelihood','backgroundcolor',c1);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_results_Callback(hObject, eventdata, handles)
ifig=intersect(findobj,handles.fig);
set(ifig,'visible','off')
c1=get(handles.pushbutton_save,'backgroundcolor');
set(handles.pushbutton_results,'string','WAIT ...','backgroundcolor','red');
s=handles.parameters;
Kres=500;
hfig=handles.fig(3:end);
%posf=get(handles.frame8,'position');
resultmlx(s,Kres,hfig);
set(handles.pushbutton_results,'string','The results','backgroundcolor',c1);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_simul_Callback(hObject, eventdata, handles)
c1=get(handles.pushbutton_save,'backgroundcolor');
%txtstring=get(handles.pushbutton_simul,'string');
txtstring='Data set';
set(handles.pushbutton_simul,'string','WAIT ...','backgroundcolor','red');
%pause(1)
s=handles.parameters;
eval(['load(''',s.resultats,''');']);
nphi0=length(i0);
nphi1=length(i1);
phi=zeros(N,nphi0+nphi1);
if nphi0>0;
    phi(:,i0)=mprior_phi0;
end;
if nphi1>0;
    Gamma2_phi1=cov_random(i1,i1);
    mprior_phi1=mprior_phi(:,i1);
    phi(:,i1)=randn(N,nphi1)*sqrt(Gamma2_phi1)+mprior_phi1;
end;
[f,g]=feval(fonction,phi,design,id);
ysim=f+g.*randn(size(y))*sqrt(sigma2);
jy=size(design,2)+2;
S=load(s.donnees);
S(:,jy)=ysim;
fid=fopen(s.simul,'w');
fprintf(fid,[repmat('%d  ',1,size(S,2)),'\n'],S');
fclose(fid);
set(handles.pushbutton_simul,'string',txtstring,'backgroundcolor',c1);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_datafile_Callback(hObject, eventdata, handles)
[f,p]=uigetfile('*.txt','Select the data file');
s=handles.parameters;
s.donnees=[p f];
%set(handles.edit_datafile,'string',fullfile(p,f))
set(handles.edit_datafile,'string',f)
handles.parameters=s;
guidata(hObject, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_resfile_Callback(hObject, eventdata, handles)
[f,p]=uigetfile('*_res.mat','Select the results file');
s=handles.parameters;
s.resultats=[p f];
set(handles.edit_resfile,'string',f)
handles.parameters=s;
guidata(hObject, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_simulfile_Callback(hObject, eventdata, handles)
[f,p]=uigetfile('*_sim.txt','Simulated data file');
s=handles.parameters;
s.simul=[p f];
%set(handles.edit_simulfile,'string',fullfile(p,f))
set(handles.edit_simulfile,'string',f)
handles.parameters=s;
guidata(hObject, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_function_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_new_Callback(hObject, eventdata, handles)
s.fonction=[];
s.donnees=[];
s.nb_varex=1;
s.nb_covariates=0;
s.nb_param=1;
s.var_phi_ini=0;
s.mcov=1;
s.lcov_ini=0;
s.covstruct=1;
s.va=[0  1];
s.vna=[200  300];
s.Klog=5000;
s.minv=0;
s.sigma2_ini= 0;
s.nmc=3;
s.rmcmc=0.5;
s.kitaff=100;
s.niter0=300;
s.nu=[2 5 5];
s.logstruct=0;
s.resultats='new_res.mat';
s.simul='new_sim.mat';
s.iop_var=1;
s.coef_sa=0.9;

handles.parameters=s;
guidata(hObject, handles);
if isfield(handles,'hdl_param')
    set([handles.hdl_param handles.hdl_ini handles.hdl_algo handles.hdl_sa handles.hdl_results],'visible','off')
end;

handles=disp_project(handles);

set(handles.hdl_data,'visible','on')
set(handles.frame2,'visible','on')
set(handles.text_estimate,'visible','on')
set(handles.pushbutton_estimate,'visible','on')
set(handles.pushbutton_likelihood,'visible','on')
set(handles.frame3,'visible','on')
set(handles.text_test,'visible','on')
set(handles.pushbutton_test1,'visible','on')
set(handles.pushbutton_test2,'visible','on')
set(handles.frame8,'visible','on')
set(handles.text_results,'visible','on')
set(handles.pushbutton_results,'visible','on')
set(handles.frame13,'visible','on')
set(handles.text_simul,'visible','on')
set(handles.pushbutton_simul,'visible','on')
%set([handles.hdl_param handles.hdl_ini handles.hdl_algo handles.hdl_results],'visible','off')

set(handles.popup_nbcovariates,'UserData',handles.popup_nbparam);
set(handles.popup_nbparam,'UserData',handles.popup_nbcovariates);
% clbk5=['mainmlx(''nb_covariates_Callback'',gcbo,[],guidata(gcbo));'];
% clbk6=['mainmlx(''nb_param_Callback'',gcbo,[],guidata(gcbo));'];
% set(handles.popup_nbcovariates,'callback',[clbk5]);
% set(handles.popup_nbparam,'callback',[clbk6]);
guidata(hObject, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_load_Callback(hObject, eventdata, handles)
if isfield(handles,'hdl_data')
    set([handles.hdl_data],'visible','off')
end;
if isfield(handles,'hdl_param')
    set([handles.hdl_param handles.hdl_ini  handles.hdl_algo handles.hdl_sa handles.hdl_results],'visible','off')
end;
[f,p]=uigetfile('*_param.mat','Select the parameters file');
if isequal(f,0) | isequal(p,0)
else
    load([p f]);
    %  if isfield(s,'log')==0; s.i_log=0; end;
    if isfield(s,'simul')==0; s.simul='simulated_data.txt'; end;
    handles.parameters=s;
    handles= disp_project(handles);
    set(handles.frame2,'visible','on')
    set(handles.text_estimate,'visible','on')
    set(handles.pushbutton_estimate,'visible','on')
    set(handles.pushbutton_likelihood,'visible','on')
    set(handles.frame3,'visible','on')
    set(handles.text_test,'visible','on')
    set(handles.pushbutton_test1,'visible','on')
    set(handles.pushbutton_test2,'visible','on')
    set(handles.frame8,'visible','on')
    set(handles.text_results,'visible','on')
    set(handles.pushbutton_results,'visible','on')
    set(handles.frame13,'visible','on')
    set(handles.text_simul,'visible','on')
    set(handles.pushbutton_simul,'visible','on')
    set(handles.checkbox_sa,'value',0)
    set(handles.edit_sa1,'string',s.coef_sa)
    set(handles.popup_nbcovariates,'UserData',handles.popup_nbparam);
    %clbk5=['mainmlx(''nb_covariates_Callback'',gcbo,[],guidata(gcbo));'];
    %set(handles.popup_nbcovariates,'callback',clbk5);
    set(handles.popup_nbparam,'UserData',handles.popup_nbcovariates);
    %clbk6=['mainmlx(''nb_param_Callback'',gcbo,[],guidata(gcbo));'];
    %set(handles.popup_nbparam,'callback',clbk6);
    guidata(hObject, handles);
end;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_save_Callback(hObject, eventdata, handles)
s=reactual(handles);
[f,p]=uiputfile('*_param.mat');
save([p f],'s')

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_function_Callback(hObject, eventdata, handles)
[f,p]=uigetfile('*.m');
j=find(f=='.');
f=f(1:j-1);
s=handles.parameters;
s.fonction=[f];
set(handles.edit_function,'string', f)
handles.parameters=s;
guidata(hObject, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function handles=disp_project(handles);
color2=[.9 .8 .7];
color3=get(handles.text_step,'foregroundcolor');
s=handles.parameters;
fonction=getfield(s,'fonction');
donnees=getfield(s,'donnees');
resultats=getfield(s,'resultats');
mcov=getfield(s,'mcov');
lcov_ini=getfield(s,'lcov_ini');
var_phi_ini=getfield(s,'var_phi_ini');
va=getfield(s,'va');
Klog=getfield(s,'Klog');
minv=getfield(s,'minv');
kitaff=getfield(s,'kitaff');
nu=getfield(s,'nu');
rmcmc=getfield(s,'rmcmc');
nmc=getfield(s,'nmc');
vna=getfield(s,'vna');
niter0=getfield(s,'niter0');
sigma2_ini=getfield(s,'sigma2_ini');
nb_varex=getfield(s,'nb_varex');
nb_param=getfield(s,'nb_param');
nb_covariates=getfield(s,'nb_covariates');
covstruct=getfield(s,'covstruct');
logstruct=getfield(s,'logstruct');
iop_var=getfield(s,'iop_var');
coef_sa=getfield(s,'coef_sa');
set(handles.checkbox_sa,'userdata',color3)

clx=0.018;
cly=0.025;
xl=0.04; xll=xl-0.0;
yl=0.022; yll=yl-0.0;
dy=0.05;
slider_length=0.1;

set(handles.popup_nbvarex,'string',1:10)
set(handles.popup_nbvarex,'value',nb_varex)
set(handles.popup_nbparam,'string',1:10)
set(handles.popup_nbparam,'value',nb_param)
set(handles.popup_nbcovariates,'string',0:10)
set(handles.popup_nbcovariates,'value',nb_covariates+1)
P1=get(handles.text_covariates,'Position');
[ncov,nphi]=size(mcov);
posx0=P1(1)+P1(3)/2-nphi*clx/2;
posy0=P1(2)-dy*.6;
pos=[posx0 posy0 clx cly];
handles.hmcov=zeros(ncov,nphi);
for k1=1:ncov
    pos(1)=posx0;
    for k2=1:nphi
        handles.hmcov(k1,k2)=uicontrol('unit','normalized','style','pushbutton',...
            'position',pos,'string',mcov(k1,k2),'userdata',[k1 k2]);
        pos(1)=pos(1)+clx;
    end;
    pos(2)=pos(2)-cly;
end;

if ispc
    set(handles.hmcov,'BackgroundColor','white');
else
    set(handles.hmcov,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end
Str='mainmlx(''mcov_Callback'',gcbo,[],guidata(gcbo));';
set(handles.hmcov,'Callback',Str);

P1=get(handles.text_covariance,'Position');
posx0=P1(1)+P1(3)/2-nphi*clx/2;
posy0=P1(2)-dy*.6;
pos=[posx0 posy0 clx cly];
handles.covstruct=zeros(nphi,nphi);
for k1=1:nphi
    pos(1)=posx0;
    for k2=1:nphi
        handles.covstruct(k1,k2)=uicontrol('unit','normalized','style','pushbutton','position',pos,'string',covstruct(k1,k2));
        pos(1)=pos(1)+clx;
    end;
    pos(2)=pos(2)-cly;
end;
if ispc
    set(handles.covstruct,'BackgroundColor','white');
else
    set(handles.covstruct,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end
Str='mainmlx(''covstruct_Callback'',gcbo,[],guidata(gcbo));';
set(handles.covstruct,'Callback',Str);
P0=get(handles.covstruct(ceil(nphi/2),nphi),'position');
P1=get(handles.radiobutton_covariance1,'position');
P1(1)=P0(1)+1.5*P0(3);
P1(2)=P0(2);
P2=P1;
P2(2)=P1(2)-P0(4);
set(handles.radiobutton_covariance1,'position',P1);
set(handles.radiobutton_covariance2,'position',P2);
set(handles.radiobutton_covariance1,'value',0)
set(handles.radiobutton_covariance2,'value',0)

P1=get(handles.text_log,'Position');
posx0=P1(1)+P1(3)/2-nphi*clx/2;
posy0=P1(2)-dy*.6;
pos=[posx0 posy0 clx cly];
handles.logstruct=zeros(1,nphi);
logstring=repmat('N',1,nphi);
j=find(logstruct==1);
logstring(j)=repmat('L',1,length(j));
for k=1:nphi
    handles.logstruct(k)=uicontrol('unit','normalized','style','pushbutton','position',pos,'string',logstring(k),...
        'Userdata',k);
    pos(1)=pos(1)+clx;
end;
if ispc
    set(handles.logstruct,'BackgroundColor','white');
else
    set(handles.logstruct,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end
Str='mainmlx(''logstruct_Callback'',gcbo,[],guidata(gcbo));';
set(handles.logstruct,'Callback',Str);


P1=get(handles.text_inifix,'Position');
posx0=P1(1)+P1(3)/2-nphi*xl/2;
posy0=P1(2)-dy/2;
pos=[posx0 posy0 xl yl];
handles.edit_fini=zeros(ncov,nphi);
for k1=1:ncov
    pos(1)=posx0;
    for k2=1:nphi
        if mcov(k1,k2)==1
            str=lcov_ini(k1,k2);
        else
            str='';
        end;
        handles.edit_fini(k1,k2)=uicontrol('unit','normalized','style','edit','position',pos,'string',str);
        pos(1)=pos(1)+xll;
    end;
    pos(2)=pos(2)-yll;
end;
if ispc
    set(handles.edit_fini,'BackgroundColor','white');
else
    set(handles.edit_fini,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

P1=get(handles.text_inivar1,'Position');
xl=xl*1.2;
posx0=P1(1)+P1(3)/2-nphi*xl/2;
posy0=P1(2)-dy/2;
pos=[posx0 posy0 xl yl];
handles.vini=zeros(1,nphi);
for k=1:nphi
    handles.vini(k)=uicontrol('unit','normalized','style','edit','position',pos,'string',var_phi_ini(k));
    pos(1)=pos(1)+xl;
end;
%set(handles.vini,'BackgroundColor',color2);
xsl=max(slider_length,nphi*xl);
ysl=yl*1.;
posx0=P1(1)+P1(3)/2-xsl/2;
posy0=pos(2)-ysl;
pos=[posx0 posy0 xsl ysl];
mc=.5;
vc=[.01 .02:.02:.98 linspace(1,10,51)];
handles.slider_vini=uicontrol('style','slider','value',mc,'min',0,'max',1,'SliderStep',[.01 .1],'units','normalized');
set(handles.slider_vini,'position',pos)
set(handles.slider_vini,'Callback','mainmlx(''slider_vini_Callback'',gcbo,[],guidata(gcbo))');
usd1.hdl=handles.vini;
usd1.vc=vc;
set(handles.slider_vini,'userdata',usd1)
usd2.v0=var_phi_ini;
usd2.mc=mc;
set(handles.vini(1),'userdata',usd2);

P1=get(handles.text_minv,'Position');
col=get(handles.text_minv,'Foregroundcolor');
posx0=P1(1)+P1(3)/2-nphi*xl/2;
posy0=P1(2)-dy/2;
pos=[posx0 posy0 xl yl];
handles.edit_minv=zeros(1,nphi);
for k=1:nphi
    handles.edit_minv(k)=uicontrol('unit','normalized','style','edit','position',pos,'string',minv(k),'Foregroundcolor',col);
    pos(1)=pos(1)+xl;
end;
%set(handles.edit_minv,'BackgroundColor',color2);

P1=get(handles.text_inivareps1,'Position');
xls=xl*1.5;
posx0=P1(1)+P1(3)/2-xls/2;
posy0=P1(2)-dy/2;
pos=[posx0 posy0 xls yl];
handles.sini=uicontrol('unit','normalized','style','edit','position',pos,'string',sigma2_ini);
%set(handles.sini,'BackgroundColor',color2);
posx0=P1(1)+P1(3)/2-slider_length/2;
posy0=pos(2)-yl;
pos=[posx0 posy0 slider_length yl];
mc=0.5;
%mc=sigma2_ini;
% if mc>=0.1
%    % handles.slider_sini=uicontrol('unit','normalized','style','slider','value',mc,'max',2*mc,'SliderStep' ,[0.01 0.1]*mc,'position',pos);
%     handles.slider_sini=uicontrol('unit','normalized','style','slider','value',mc,'max',2*mc,'position',pos);
% else
handles.slider_sini=uicontrol('unit','normalized','style','slider','value',mc,'max',2*mc);
set(handles.slider_sini,'position',pos);
%end;
clbk=['slx=get(gcbo,''value''); h=get(gcbo,''userdata''); sini=get(h,''userdata''); set(h,''string'',num2str(2*slx*sini))'];
set(handles.slider_sini,'Callback',clbk);
set(handles.slider_sini,'userdata',handles.sini)
set(handles.sini,'userdata',sigma2_ini)

set(handles.edit_step,'string',sprintf('%g   ',va));
niter=sum(vna);
na=length(va);


set(handles.radiobutton_var1,'value',iop_var)
set(handles.radiobutton_var2,'value',1-iop_var)

set(handles.popup_nchain,'string',1:10)
set(handles.popup_nchain,'value',nmc)
%set(handles.popup_nchain,'string',sprintf('%d',nmc),'fontweight','normal');
ff=sprintf('%d  ',vna); ff(end-1:end)=[];
set(handles.edit_nitera,'string',ff,'fontweight','normal');
%clbkb=['slx=str2num(get(gcbo,''string''));  h=get(gcbo,''userdata''); vna=str2num(get(h,''string'')); '];
%clbkb=[clbkb 'vna(end)=slx-sum(vna(1:end-1));  ff=sprintf(''%d   '',vna); ff(end-1:end)=[]; set(h,''string'',ff)  '];
%clbka=['vna=str2num(get(gcbo,''string''));  h=get(gcbo,''userdata''); set(h,''string'',sprintf(''%d'',sum(vna)))  '];
%set(handles.edit_nitera,'callback',clbka);
set(handles.edit_niter1,'string',sprintf('%d',nu(1)));
set(handles.edit_niter2,'string',sprintf('%d',nu(2)));
set(handles.edit_niter3,'string',sprintf('%d',nu(3)));
set(handles.edit_vareta,'string',sprintf('%g',rmcmc));
%set(handles.edit_minv,'string',sprintf('%g',minv));
set(handles.edit_disp,'string',sprintf('%d',kitaff));
set(handles.edit_like,'string',sprintf('%d',Klog));
set(handles.edit_N0,'string',sprintf('%d',niter0)) ;
set(handles.edit_sa1,'string',sprintf('%0.3g',coef_sa)) ;

hdl_data=[handles.frame4 handles.text13 handles.pushbutton_dispdata handles.pushbutton_datafile handles.edit_datafile handles.text_nbvarex handles.popup_nbvarex];
hdl_data=[hdl_data handles.text_nbcovariates handles.popup_nbcovariates handles.text_nbparam handles.popup_nbparam];
hdl_function=[handles.pushbutton_function handles.edit_function];
hdl_param=[handles.frame5 handles.text14 handles.text_covariates handles.text_covariance handles.radiobutton_covariance1 handles.radiobutton_covariance2];
hdl_param=[hdl_param handles.pushbutton_function handles.edit_function handles.hmcov(:)' handles.covstruct(:)'];
hdl_param=[hdl_param handles.text_log handles.logstruct];
hdl_ini=[handles.frame6 handles.text15 handles.text_inifix handles.text_inivar1 handles.edit_fini(:)' handles.text_inivareps1];
hdl_ini=[hdl_ini handles.edit_fini(:)' handles.vini  handles.slider_vini handles.sini handles.slider_sini handles.pushbutton_varini];
hdl_algo=[handles.frame7 handles.text16 handles.text_nitera handles.text_step handles.text_niter1 handles.text_niter2 handles.text_niter3 handles.text_nchain handles.text_vareta];
hdl_algo=[hdl_algo handles.edit_step handles.edit_nitera  handles.edit_niter1 handles.edit_niter2 handles.edit_niter3 handles.edit_vareta handles.popup_nchain];
hdl_algo=[hdl_algo handles.text_minv handles.text_disp handles.text_like handles.text_N0];
hdl_algo=[hdl_algo handles.edit_minv handles.edit_disp handles.edit_like handles.edit_N0 handles.checkbox_sa ];
hdl_sa=[handles.text_sa1 handles.edit_sa1 handles.text_sa2 handles.edit_sa2 ];
hdl_results=[handles.frame9 handles.text38 handles.pushbutton_resfile handles.edit_resfile handles.pushbutton_simulfile handles.edit_simulfile];
hdl_results=[hdl_results  handles.radiobutton_var1  handles.radiobutton_var2];
handles.hdl_data=hdl_data;
handles.hdl_ini=hdl_ini;
handles.hdl_algo=hdl_algo;
handles.hdl_sa=hdl_sa;
handles.hdl_param=hdl_param;
handles.hdl_results=hdl_results;

j=find(s.donnees=='\');
if length(j)>0
    donnees_text=s.donnees(j(end)+1:end);
else
    donnees_text=s.donnees;
end;
set(handles.edit_datafile,'string',donnees_text)
set(handles.popup_nbvarex,'value',s.nb_varex)
set(handles.edit_function,'string',s.fonction)
set(handles.edit_resfile,'string',s.resultats)
set(handles.edit_simulfile,'string',s.simul)

set(findobj(handles.figure_mainmlx,'FontUnits','pixels'),'FontUnits','Normalized');
set([handles.hdl_data handles.hdl_param handles.hdl_ini handles.hdl_algo handles.hdl_results],'visible','on')
guidata(gcbo, handles);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function s=reactual(handles);
s=handles.parameters;

s.fonction=get(handles.edit_function,'string');
s.donnees=get(handles.edit_datafile,'string');
s.resultats=get(handles.edit_resfile,'string');
s.simul=get(handles.edit_simulfile,'string');

svar_phi_ini=get(handles.vini,'string');
if iscell(svar_phi_ini)
    s.var_phi_ini=str2num(str2mat(svar_phi_ini))';
    nphi=length(svar_phi_ini);
else
    s.var_phi_ini=str2num(svar_phi_ini);
    nphi=1;
end;
smcov=get(handles.hmcov,'string');
if iscell(smcov)
    nb_covariates=length(smcov)/nphi;
    s.mcov=reshape(str2num(cell2mat(smcov)),nb_covariates,nphi);
else
    s.mcov=str2num(smcov);
    nb_covariates=length(s.mcov)/nphi;
end;
s.lcov_ini=zeros(nb_covariates,nphi);
for k1=1:nb_covariates
    for k2=1:nphi
        if s.mcov(k1,k2)==1
            s.lcov_ini(k1,k2)=str2num(get(handles.edit_fini(k1,k2),'string'));
        end;
    end;
end;
hc=get(handles.covstruct,'string');
if iscell(hc)
    s.covstruct=reshape(str2num(cell2mat(hc)),nphi,nphi);
else
    s.covstruct=str2num(hc);
end;
s.va=str2num(get(handles.edit_step,'string'));
s.Klog=str2num(get(handles.edit_like,'string'));
for k=1:nphi
    s.minv(k)=str2num(get(handles.edit_minv(k),'string'));
end;
s.kitaff=str2num(get(handles.edit_disp,'string'));
s.nu(1)=str2num(get(handles.edit_niter1,'string'));
s.nu(2)=str2num(get(handles.edit_niter2,'string'));
s.nu(3)=str2num(get(handles.edit_niter3,'string'));
s.rmcmc=str2num(get(handles.edit_vareta,'string'));
s.nmc=get(handles.popup_nchain,'value');
s.vna=str2num(get(handles.edit_nitera,'string'));
s.niter0=str2num(get(handles.edit_N0,'string'));
s.sigma2_ini=str2num(get(handles.sini,'string'));
s.nb_varex=get(handles.popup_nbvarex,'value');
s.coef_sa=str2num(get(handles.edit_sa1,'string'));
s.logstruct=zeros(1,nphi);
logstring=get(handles.logstruct,'string');
if nphi==1
    if logstring=='L'
        s.logstruct=1;
    end;
else
    j=find(cell2mat(logstring)=='L');
    s.logstruct(j)=1;
end;
handles.parameters=s;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function covstruct_Callback(hObject, eventdata, handles)
hc=handles.covstruct;
[i,j]=find(hc==hObject);
strh=get(hObject,'string');
strh1=num2str(1-str2num(strh));
set(hObject,'string', strh1);
if i  ~= j
    set(hc(j,i),'string', strh1);
    if strh1=='1'
        set(hc(i,i),'string', '1');
        set(hc(j,j),'string', '1');
    end;
else
    if str2num(strh)==1
        set(hc(i,:),'string', 0);
        set(hc(:,j),'string', 0);
    end;
end;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function radiobutton_covariance1_Callback(hObject, eventdata, handles)
set(handles.radiobutton_covariance1,'value',1)
set(handles.radiobutton_covariance2,'value',0)
[nphi,nphi]=size(handles.covstruct);
set(handles.covstruct,'string',0)
for k=1:nphi
    set(handles.covstruct(k,k),'string',1)
end;
guidata(gcbo, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function radiobutton_covariance2_Callback(hObject, eventdata, handles)
set(handles.radiobutton_covariance1,'value',0)
set(handles.radiobutton_covariance2,'value',1)
set(handles.covstruct,'string',1)
guidata(gcbo, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function radiobutton_var1_Callback(hObject, eventdata, handles)
set(handles.radiobutton_var1,'value',1)
set(handles.radiobutton_var2,'value',0)
handles.parameters.iop_var=1;
guidata(gcbo, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function radiobutton_var2_Callback(hObject, eventdata, handles)
set(handles.radiobutton_var1,'value',0)
set(handles.radiobutton_var2,'value',1)
handles.parameters.iop_var=0;
guidata(gcbo, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function popup_nbvarex_Callback(hObject, eventdata, handles)
nb_varex=get(gcbo,'value');
handles.parameters.nb_varex=nb_varex;
guidata(hObject, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function popup_nbparam_Callback(hObject, eventdata, handles)
if isfield(handles,'hdl_param')
    set([handles.hdl_param handles.hdl_ini handles.hdl_algo handles.hdl_sa handles.hdl_results],'visible','off')
end;
nphi=get(gcbo,'value');
h=get(gcbo,'userdata');
nb_covariates=get(h,'value')-1;
handles.parameters.nb_param=nphi;
handles.parameters=reactual(handles);
handles.parameters.covstruct=diag(ones(nphi,1));
handles.parameters.minv=zeros(1,nphi);
handles.parameters.var_phi_ini=repmat(handles.parameters.var_phi_ini,1,nphi);
handles.parameters.mcov=zeros(nb_covariates+1,nphi);
handles.parameters.mcov(1,:)=ones(1,nphi);
handles.parameters.lcov_ini=zeros(nb_covariates+1,nphi);
if handles.parameters.logstruct(1)==0
    handles.parameters.logstruct=zeros(1,nphi);
else
    handles.parameters.logstruct=ones(1,nphi);
    handles.parameters.lcov_ini(1,:)=ones(1,nphi);
end;
handles= disp_project(handles);
set(handles.frame2,'visible','on')
set(handles.text_estimate,'visible','on')
set(handles.pushbutton_estimate,'visible','on')
guidata(hObject, handles);


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function popup_nbcovariates_Callback(hObject, eventdata, handles)
if isfield(handles,'hdl_param')
    set([handles.hdl_param handles.hdl_ini handles.hdl_algo handles.hdl_sa handles.hdl_results],'visible','off')
end;
nb_covariates=get(gcbo,'value')-1;
h=get(gcbo,'userdata');
nphi=get(h,'value');
handles.parameters.nb_covariates=nb_covariates;
handles.parameters=reactual(handles);
%handles.parameters.covstruct=diag(ones(nphi,1));
l1=handles.parameters.lcov_ini(1,:);
handles.parameters.lcov_ini=zeros(nb_covariates+1,nphi);
handles.parameters.lcov_ini(1,:)=l1;
handles.parameters.mcov=zeros(nb_covariates+1,nphi);
handles.parameters.mcov(1,:)=ones(1,nphi);
handles= disp_project(handles);
set(handles.frame2,'visible','on')
set(handles.text_estimate,'visible','on')
set(handles.pushbutton_estimate,'visible','on')
guidata(hObject, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function mcov_Callback(hObject, eventdata, handles)
covstring=get(gco,'string');
k=get(gco,'userdata');
k1=k(1);
k2=k(2);
handles.parameters=reactual(handles);
if (k1==1) & (handles.parameters.logstruct(k1,k2)==1)
    strk1k2=1;
else
    strk1k2=0;
end;
handles.parameters.lcov_ini(k1,k2)=strk1k2;
if covstring=='1'
    set(gco,'string','0')
    handles.parameters.mcov(k1,k2)=0;
    set(handles.edit_fini(k1,k2),'string','')
else
    set(gco,'string','1')
    handles.parameters.mcov(k1,k2)=1;
    set(handles.edit_fini(k1,k2),'string',strk1k2)
end;
guidata(hObject, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function logstruct_Callback(hObject, eventdata, handles)
logstring=get(gco,'string');
k=get(gco,'userdata');
handles.parameters=reactual(handles);
lcov_ini=handles.parameters.lcov_ini;
if logstring=='L'
    lcov_ini(1,k)=log(lcov_ini(1,k));
    set(gco,'string','N')
    handles.parameters.logstruct=0;
    %j1=find(lcov_ini==1);
    %lcov_ini(j1)=zeros(size(j1));
else
    lcov_ini(1,k)=exp(lcov_ini(1,k));
    set(gco,'string','L')
    handles.parameters.logstruct=1;
    %j0=find(lcov_ini==0);
    % lcov_ini(j0)=ones(size(j0));
end;
handles.parameters.lcov_ini=lcov_ini;
if handles.parameters.mcov(1,k)==1
    set(handles.edit_fini(1,k),'string',num2str(lcov_ini(1,k),'%0.3g'))
end;
%disp(handles.parameters)
guidata(hObject, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function slider_vini_Callback(hObject, eventdata, handles)
mc1=get(gcbo,'value');
slx=round(mc1*100)+1;
%if slx==0; slx=1; end;
usd1=get(gcbo,'userdata');
h=usd1.hdl;
vc=usd1.vc;
vc1=vc(slx);
usd2=get(h(1),'userdata');
v0=usd2.v0;
mc0=usd2.mc;
slx0=round(mc0*100)+1;
vc0=vc(slx0);
usd2.mc=mc1;
set(h,'userdata',usd2);
for k=1:length(h)
    st=str2num(get(h(k),'string'));
    %set(h(k),'string',num2str(slx/cell2mat(mc(k))*st));
    set(h(k),'string',num2str(st*vc1/vc0));
end;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_varini_Callback(hObject, eventdata, handles)
s=reactual(handles);
lini=s.lcov_ini(1,:);
j=find(s.logstruct==1);
lini(j)=log(s.lcov_ini(1,j));
vini=(lini.^2)*.5;
j=find(vini==0); vini(j)=1;
l=floor(log10(vini)-1);
s.var_phi_ini=round(vini./10.^l).*10.^l;
S=load(s.donnees);
jy=s.nb_varex+2;
y=S(:,jy);
covini=cov(y(:))*0.5;
l=floor(log10(covini));
s.sigma2_ini=round(covini/10^l)*10^l;
handles.parameters=s;
handles=disp_project(handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_test1_Callback(hObject, eventdata, handles)
handles.parameters=reactual(handles);
testmlx(handles.parameters,handles.fig(2),1)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_test2_Callback(hObject, eventdata, handles)
handles.parameters=reactual(handles);
testmlx(handles.parameters,handles.fig(2),2)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function checkbox_sa_Callback(hObject, eventdata, handles)
iop_sa=get(handles.checkbox_sa,'value');
color3=get(handles.checkbox_sa,'userdata');
vna=str2num(get(handles.edit_nitera,'string'));
vna10=handles.parameters.vna(1);
vna00=handles.parameters.niter0;
if iop_sa==1
    res=handles.parameters.resultats;
    if exist(res,'file')>0
        set(handles.sini,'value',str2num(get(handles.sini,'string')))
        for k=1:length(handles.vini)
            set(handles.vini(k),'value',str2num(get(handles.vini(k),'string')))
        end;
        T0=10;
        tau=0.99;
        Ksa=400;
        if Ksa>vna(1)
            vna11=Ksa;
            vna00=vna00+Ksa-vna(1);
        else
            vna11=vna(1);
        end;
        load(res)
        Gamma2_phi1=cov_random(i1,i1);
        D=diag(Gamma2_phi1);
        sigma2t=str2num(num2str(sigma2*T0,'%1.2g'));
        set(handles.sini,'string',num2str(sigma2t));
        for k=1:length(i1)
            Dt=str2num(num2str(D(k)*T0,'%1.2g'));
            set(handles.vini(i1(k)),'string',Dt);
        end;
        %    set(handles.edit_sa1,'string','0.99','foregroundcolor',[0 0 0]);
        %   set(handles.edit_sa2,'string','10','foregroundcolor',[0 0 0]);
        %   set(handles.checkbox_sa,'foregroundcolor',[0 0 0]);
        set(handles.edit_sa1,'string',tau);
        set(handles.edit_sa2,'string',T0);
        set(handles.hdl_sa,'visible','on');
        vna(1)=vna11;
    else
        disp('  You must estimate first the parameters without Simulated Annealing')
    end;
else
    %          set(handles.edit_sa1,'string','0','foregroundcolor',color3);
    %        set(handles.checkbox_sa,'foregroundcolor',color3);
    set(handles.sini,'string',num2str(get(handles.sini,'value')));
    for k=1:length(handles.vini)
        set(handles.vini(k),'string',num2str(get(handles.vini(k),'value')));
    end;
    set(handles.edit_sa1,'string','0.9');
    set(handles.hdl_sa,'visible','off');
    vna(1)=vna10;
end;
ff=sprintf('%d  ',vna); ff(end-1:end)=[];
set(handles.edit_nitera,'string',ff);
set(handles.edit_N0,'string',num2str(vna00));

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_sa2_Callback(hObject, eventdata, handles)
T0=str2num(get(handles.edit_sa2,'string'));
res=handles.parameters.resultats;
load(res)
        Gamma2_phi1=cov_random(i1,i1);
D=diag(Gamma2_phi1);
sigma2t=str2num(num2str(sigma2*T0,'%1.2g'));
set(handles.sini,'string',num2str(sigma2t));
for k=1:length(i1)
    Dt=str2num(num2str(D(k)*T0,'%1.2g'));
    set(handles.vini(i1(k)),'string',Dt);
end;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function pushbutton_close_Callback(hObject, eventdata, handles)
set(0,'DefaultFigureunits','pixels','DefaultFiguremenubar','figure','DefaultFigurenumbertitle','on');
if ispc==0
    load temp_dUBC
    set(0,'defaultUicontrolBackgroundColor',dUBC)
    delete temp_dUBC.mat
end;
delete temp*.mat
close all

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_resfile_Callback(hObject, eventdata, handles)
handles.parameters.resultats=get(gco,'string');
guidata(gcbo, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_simulfile_Callback(hObject, eventdata, handles)
handles.parameters.simul=get(gco,'string');
guidata(gcbo, handles);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_datafile_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function popup_nbvarex_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_niter1_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_niter2_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_niter3_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_vareta_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function popup_nchain_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_step_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_minv_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_disp_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_like_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_N0_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_nitera_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function popup_nbcovariates_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function popup_nbparam_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_resfile_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_simulfile_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_niter1_Callback(hObject, eventdata, handles)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_niter2_Callback(hObject, eventdata, handles)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_niter3_Callback(hObject, eventdata, handles)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_vareta_Callback(hObject, eventdata, handles)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function popup_nchain_Callback(hObject, eventdata, handles)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_nitera_Callback(hObject, eventdata, handles)
st=get(handles.edit_nitera,'string');
st=str2num(st);
stt=sum(st);
st1=st(1);
st2=str2num(get(handles.edit_N0,'string'));
st2=max(st2,st1+100);
st2=min(st2,stt-100);
set(handles.edit_N0,'string',num2str(st2));

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_step_Callback(hObject, eventdata, handles)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_minv_Callback(hObject, eventdata, handles)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_disp_Callback(hObject, eventdata, handles)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_like_Callback(hObject, eventdata, handles)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_N0_Callback(hObject, eventdata, handles)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function frame5_CreateFcn(hObject, eventdata, handles)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit21_Callback(hObject, eventdata, handles)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit21_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_sa1_Callback(hObject, eventdata, handles)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_sa2_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function edit_sa1_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end










% --- Creates and returns a handle to the GUI figure. 
function h1 = mainmlx_LayoutFcn(policy)
% policy - create a new figure or use a singleton. 'new' or 'reuse'.
if ispc==0
    dUBC=get(0,'defaultUicontrolBackgroundColor');
    save temp_dUBC dUBC
    set(0,'defaultUicontrolBackgroundColor',[1 1 1])
end;

persistent hsingleton;
if strcmpi(policy, 'reuse') & ishandle(hsingleton)
    h1 = hsingleton;
    return;
end

appdata = [];
appdata.GUIDEOptions = struct(...
    'active_h', [], ...
    'taginfo', struct(...
    'figure', 2, ...
    'pushbutton', 20, ...
    'edit', 25, ...
    'text', 49, ...
    'frame', 14, ...
    'radiobutton', 6, ...
    'listbox', 2, ...
    'slider', 4, ...
    'popupmenu', 5, ...
    'checkbox', 3), ...
    'override', 1, ...
    'release', 13, ...
    'resize', 'simple', ...
    'accessibility', 'callback', ...
    'mfile', 1, ...
    'callbacks', 1, ...
    'singleton', 1, ...
    'syscolorfig', 1, ...
    'lastSavedFile', 'D:\Monolix\Logiciel\Monolix\mainmlx.m', ...
    'blocking', 0);
appdata.lastValidTag = 'figure_mainmlx';
appdata.GUIDELayoutEditor = [];

h1 = figure(...
'Units',get(0,'defaultfigureUnits'),...
'PaperUnits',get(0,'defaultfigurePaperUnits'),...
'Color',[0.925490196078431 0.913725490196078 0.847058823529412],...
'Colormap',[0 0 0.5625;0 0 0.625;0 0 0.6875;0 0 0.75;0 0 0.8125;0 0 0.875;0 0 0.9375;0 0 1;0 0.0625 1;0 0.125 1;0 0.1875 1;0 0.25 1;0 0.3125 1;0 0.375 1;0 0.4375 1;0 0.5 1;0 0.5625 1;0 0.625 1;0 0.6875 1;0 0.75 1;0 0.8125 1;0 0.875 1;0 0.9375 1;0 1 1;0.0625 1 1;0.125 1 0.9375;0.1875 1 0.875;0.25 1 0.8125;0.3125 1 0.75;0.375 1 0.6875;0.4375 1 0.625;0.5 1 0.5625;0.5625 1 0.5;0.625 1 0.4375;0.6875 1 0.375;0.75 1 0.3125;0.8125 1 0.25;0.875 1 0.1875;0.9375 1 0.125;1 1 0.0625;1 1 0;1 0.9375 0;1 0.875 0;1 0.8125 0;1 0.75 0;1 0.6875 0;1 0.625 0;1 0.5625 0;1 0.5 0;1 0.4375 0;1 0.375 0;1 0.3125 0;1 0.25 0;1 0.1875 0;1 0.125 0;1 0.0625 0;1 0 0;0.9375 0 0;0.875 0 0;0.8125 0 0;0.75 0 0;0.6875 0 0;0.625 0 0;0.5625 0 0],...
'IntegerHandle','off',...
'InvertHardcopy',get(0,'defaultfigureInvertHardcopy'),...
'MenuBar',get(0,'defaultfigureMenuBar'),...
'Name','MONOLIX',...
'NumberTitle',get(0,'defaultfigureNumberTitle'),...
'PaperPosition',[-1.75039310344828 5.64501775862069 20 18.3791275862069],...
'PaperSize',[20.98404194812 29.67743169791],...
'PaperType',get(0,'defaultfigurePaperType'),...
'Position',[0.1 0.1 0.8 0.8],...
'Renderer',get(0,'defaultfigureRenderer'),...
'RendererMode','manual',...
'HandleVisibility','callback',...
'Tag','figure_mainmlx',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'frame9';

h2 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.121212121212121,...
'ListboxTop',0,...
'Position',[0.03125 0.015 0.815178571428571 0.115],...
'String',{  '' },...
'Style','frame',...
'Tag','frame9',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text38';

h3 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.8,...
'FontWeight','bold',...
'ForegroundColor',[0.5 0.25 0],...
'ListboxTop',0,...
'Position',[0.366071428571429 0.0988095238095238 0.149107142857143 0.019047619047619],...
'String','THE RESULTS',...
'Style','text',...
'Tag','text38',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'frame6';

h4 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.8,...
'ListboxTop',0,...
'Position',[0.03125 0.379761904761905 0.814285714285714 0.230952380952381],...
'String',{  '' },...
'Style','frame',...
'Tag','frame6',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text15';

h5 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.8,...
'FontWeight','bold',...
'ForegroundColor',[0.5 0.25 0],...
'ListboxTop',0,...
'Position',[0.366964285714286 0.582142857142857 0.149107142857143 0.019047619047619],...
'String','THE INITIALIZATION',...
'Style','text',...
'Tag','text15',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'frame5';

h6 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.8,...
'ListboxTop',0,...
'Position',[0.03125 0.633333333333334 0.814285714285714 0.230952380952381],...
'String',{  '' },...
'Style','frame',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''frame5_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','frame5',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'frame4';

h7 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.121212121212121,...
'ListboxTop',0,...
'Position',[0.03125 0.88452380952381 0.815178571428571 0.0892857142857143],...
'String',{  '' },...
'Style','frame',...
'Tag','frame4',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'frame2';

h8 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.588235294117647 0.796078431372549 0.796078431372549],...
'CData',[],...
'FontName','default',...
'FontSize',0.0658436213991769,...
'ForegroundColor',[0.5 0 0.25],...
'ListboxTop',0,...
'Position',[0.879464285714286 0.578571428571429 0.0982142857142857 0.161904761904762],...
'String',{  '' },...
'Style','frame',...
'Tag','frame2',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'frame1';

h9 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.588235294117647 0.796078431372549 0.796078431372549],...
'CData',[],...
'FontName','default',...
'FontSize',0.0507936507936508,...
'ForegroundColor',[0.5 0 0.25],...
'ListboxTop',0,...
'Position',[0.879464285714286 0.764285714285714 0.0982142857142857 0.20952380952381],...
'String',{  '' },...
'Style','frame',...
'Tag','frame1',...
'UserData',[],...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton_new';

h10 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_new_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontSize',0.4,...
'ListboxTop',0,...
'Position',[0.884821428571429 0.889285714285714 0.0875 0.0392857142857143],...
'String','New',...
'Tag','pushbutton_new',...
'UserData',[],...
...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton_estimate';

h11 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_estimate_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontSize',0.4,...
'ListboxTop',0,...
'Position',[0.884821428571429 0.65 0.0875 0.0392857142857143],...
'String','Parameters',...
'Tag','pushbutton_estimate',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton_likelihood';

h12 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_likelihood_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontSize',0.4,...
'ListboxTop',0,...
'Position',[0.884821428571429 0.596428571428572 0.0875 0.0392857142857143],...
'String','Log-likelihood',...
'Tag','pushbutton_likelihood',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'edit_datafile';

h13 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'CData',[],...
'FontName','default',...
'FontSize',0.5,...
'ListboxTop',0,...
'Position',[0.0883928571428571 0.9 0.125 0.0297619047619048],...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_datafile_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_datafile',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'pushbutton_datafile';

h14 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_datafile_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.5,...
'ListboxTop',0,...
'Position',[0.0883928571428571 0.926190476190476 0.125 0.0297619047619048],...
'String','Data file: ',...
'Tag','pushbutton_datafile',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton_close';

h15 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.588235294117647 0.796078431372549 0.796078431372549],...
'Callback','mainmlx(''pushbutton_close_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.45,...
'FontWeight','bold',...
'ListboxTop',0,...
'Position',[0.8875 0.015 0.0821428571428571 0.0392857142857143],...
'String','close',...
'Tag','pushbutton_close',...
'UserData',[],...
...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton_load';

h16 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_load_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontSize',0.4,...
'ListboxTop',0,...
'Position',[0.884821428571429 0.836904761904762 0.0875 0.0392857142857143],...
'String','Load',...
'Tag','pushbutton_load',...
'UserData',[],...
...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton_save';

h17 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_save_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontSize',0.4,...
'ListboxTop',0,...
'Position',[0.884821428571429 0.78452380952381 0.0875 0.0392857142857143],...
'String','Save',...
'Tag','pushbutton_save',...
'UserData',[],...
...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_project';

h18 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.588235294117647 0.796078431372549 0.796078431372549],...
'CData',[],...
'FontName','default',...
'FontSize',0.859259259259259,...
'FontWeight','bold',...
'ListboxTop',0,...
'Position',[0.884821428571429 0.945238095238095 0.0892857142857143 0.0178571428571429],...
'String','PROJECT',...
'Style','text',...
'Tag','text_project',...
'UserData',[],...
...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_estimate';

h19 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.588235294117647 0.796078431372549 0.796078431372549],...
'CData',[],...
'FontName','default',...
'FontSize',0.859259259259259,...
'FontWeight','bold',...
'ListboxTop',0,...
'Position',[0.884821428571429 0.707142857142857 0.0892857142857143 0.0178571428571429],...
'String','ESTIMATION',...
'Style','text',...
'Tag','text_estimate',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'popup_nbvarex';

h20 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''popup_nbvarex_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.560386473429952,...
'ListboxTop',0,...
'Max',10,...
'Min',1,...
'Position',[0.407142857142857 0.897619047619048 0.0410714285714286 0.0273809523809524],...
'Style','popupmenu',...
'Value',1,...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''popup_nbvarex_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','popup_nbvarex',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'text_nbvarex';

h21 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.644444444444444,...
'HorizontalAlignment','right',...
'ListboxTop',0,...
'Position',[0.248214285714286 0.898809523809524 0.15 0.0238095238095238],...
'String','Number of design variables:',...
'Style','text',...
'Tag','text_nbvarex',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'edit_function';

h22 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'CData',[],...
'FontName','default',...
'FontSize',0.5,...
'ListboxTop',0,...
'Position',[0.680357142857143 0.657142857142857 0.125 0.0297619047619048],...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_function_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_function',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'text_covariates';

h23 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.725,...
'ListboxTop',0,...
'Position',[0.06875 0.803571428571429 0.197321428571429 0.024],...
'String','The covariate model',...
'Style','text',...
'Tag','text_covariates',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_covariance';

h24 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.725,...
'ListboxTop',0,...
'Position',[0.363392857142857 0.803571428571429 0.197321428571429 0.024],...
'String','The covariance model',...
'Style','text',...
'Tag','text_covariance',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'radiobutton_covariance1';

h25 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'Callback','mainmlx(''radiobutton_covariance1_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.65,...
'ListboxTop',0,...
'Position',[0.54 0.73 0.1125 0.023],...
'String','Diagonal matrix',...
'Style','radiobutton',...
'Tag','radiobutton_covariance1',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'radiobutton_covariance2';

h26 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'Callback','mainmlx(''radiobutton_covariance2_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.65,...
'ListboxTop',0,...
'Position',[0.54 0.67 0.1125 0.023],...
'String','Full matrix',...
'Style','radiobutton',...
'Tag','radiobutton_covariance2',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'frame3';

h27 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.588235294117647 0.796078431372549 0.796078431372549],...
'CData',[],...
'FontName','default',...
'FontSize',0.0658436213991769,...
'ForegroundColor',[0.5 0 0.25],...
'ListboxTop',0,...
'Position',[0.879464285714286 0.390476190476191 0.0982142857142857 0.161904761904762],...
'String',{  '' },...
'Style','frame',...
'Tag','frame3',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton_test1';

h28 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_test1_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontSize',0.4,...
'ListboxTop',0,...
'Position',[0.884821428571429 0.460714285714286 0.0875 0.0392857142857143],...
'String','FIxed effect',...
'Tag','pushbutton_test1',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton_test2';

h29 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_test2_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontSize',0.4,...
'ListboxTop',0,...
'Position',[0.884821428571429 0.408333333333333 0.0875 0.0392857142857143],...
'String','Random effect',...
'Tag','pushbutton_test2',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_test';

h30 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.588235294117647 0.796078431372549 0.796078431372549],...
'CData',[],...
'FontName','default',...
'FontSize',0.859259259259259,...
'FontWeight','bold',...
'ListboxTop',0,...
'Position',[0.884821428571429 0.516666666666667 0.0892857142857143 0.0178571428571429],...
'String','TEST',...
'Style','text',...
'Tag','text_test',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton_function';

h31 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_function_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.5,...
'ListboxTop',0,...
'Position',[0.68125 0.68452380952381 0.125 0.0297619047619048],...
'String','Function file: ',...
'Tag','pushbutton_function',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_inivar1';

h32 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontSize',0.7,...
'ListboxTop',0,...
'Position',[0.363392857142857 0.541666666666667 0.197321428571429 0.024],...
'String','Variances of the random effects',...
'Style','text',...
'Tag','text_inivar1',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_inifix';

h33 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.7000000000002,...
'ListboxTop',0,...
'Position',[0.0678571428571429 0.541666666666667 0.197321428571429 0.024],...
'String','Fixed effects',...
'Style','text',...
'Tag','text_inifix',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text14';

h34 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.8,...
'FontWeight','bold',...
'ForegroundColor',[0.5 0.25 0],...
'ListboxTop',0,...
'Position',[0.366964285714286 0.83452380952381 0.149107142857143 0.019047619047619],...
'String','THE MODEL',...
'Style','text',...
'Tag','text14',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'frame7';

h35 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.0719246031746032,...
'ListboxTop',0,...
'Position',[0.03125 0.154761904761905 0.8125 0.2],...
'String',{  '' },...
'Style','frame',...
'Tag','frame7',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text16';

h36 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.8,...
'FontWeight','bold',...
'ForegroundColor',[0.5 0.25 0],...
'ListboxTop',0,...
'Position',[0.366964285714286 0.321428571428571 0.149107142857143 0.019047619047619],...
'String','THE ALGORITHM',...
'Style','text',...
'Tag','text16',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_inivareps1';

h37 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.7,...
'ListboxTop',0,...
'Position',[0.642857142857143 0.541666666666667 0.196428571428571 0.024],...
'String',{  'Residual variance'; '' },...
'Style','text',...
'Tag','text_inivareps1',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_step';

h38 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.678362573099415,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.06875 0.213095238095238 0.139285714285714 0.0226190476190476],...
'String','Stepsizes',...
'Style','text',...
'Tag','text_step',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_niter1';

h39 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.755208333333333,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.48125 0.21547619047619 0.0392857142857143 0.019047619047619],...
'String','m_1',...
'Style','text',...
'Tag','text_niter1',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_nchain';

h40 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.758169934640523,...
'ListboxTop',0,...
'Position',[0.478571428571429 0.286904761904762 0.15 0.019047619047619],...
'String','Number of chains',...
'Style','text',...
'Tag','text_nchain',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_niter3';

h41 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.755208333333333,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.561607142857143 0.21547619047619 0.0392857142857143 0.019047619047619],...
'String','m_3',...
'Style','text',...
'Tag','text_niter3',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_vareta';

h42 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.755208333333333,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.611607142857143 0.21547619047619 0.0392857142857143 0.019047619047619],...
'String','rho',...
'Style','text',...
'Tag','text_vareta',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'edit_niter1';

h43 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''edit_niter1_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.549242424242424,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.483035714285714 0.183 0.0348214285714286 0.026],...
'String',{  'Edit Text' },...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_niter1_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_niter1',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'edit_niter3';

h44 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''edit_niter3_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.549242424242424,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.564285714285714 0.183 0.0348214285714286 0.026],...
'String',{  'Edit Text' },...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_niter3_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_niter3',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'edit_vareta';

h45 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''edit_vareta_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.549242424242424,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.613392857142857 0.183 0.0348214285714286 0.026],...
'String',{  'Edit Text' },...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_vareta_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_vareta',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'edit_nitera';

h46 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''edit_nitera_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.585858585858586,...
'ForegroundColor',[0.25 0 0.25],...
'ListboxTop',0,...
'Position',[0.075 0.25952380952381 0.12 0.0261904761904762],...
'String',{  'Edit Text' },...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_nitera_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_nitera',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'edit_step';

h47 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''edit_step_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.585858585858586,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.075 0.18452380952381 0.12 0.0261904761904762],...
'String',{  'Edit Text' },...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_step_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_step',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'text_disp';

h48 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.678362573099415,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.6875 0.213095238095238 0.139285714285714 0.0226190476190476],...
'String','Display iterations',...
'Style','text',...
'Tag','text_disp',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_like';

h49 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.758169934640523,...
'ListboxTop',0,...
'Position',[0.685714285714286 0.285714285714286 0.15 0.019047619047619],...
'String','Likelihood MC number',...
'Style','text',...
'Tag','text_like',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_N0';

h50 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.805555555555556,...
'ListboxTop',0,...
'Position',[0.2375 0.289285714285714 0.15 0.019047619047619],...
'String','Number of burning iterations',...
'Style','text',...
'Tag','text_N0',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_nitera';

h51 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.678362573099415,...
'ForegroundColor',[0.25 0 0.25],...
'ListboxTop',0,...
'Position',[0.0660714285714286 0.288095238095238 0.139285714285714 0.0226190476190476],...
'String','Numbers of iterations',...
'Style','text',...
'Tag','text_nitera',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'edit_disp';

h52 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''edit_disp_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.549242424242424,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.73125 0.183 0.0491071428571429 0.026],...
'String',{  'Edit Text' },...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_disp_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_disp',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'edit_like';

h53 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''edit_like_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.613756613756614,...
'ListboxTop',0,...
'Position',[0.73125 0.258333333333333 0.0491071428571429 0.025],...
'String',{  'Edit Text' },...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_like_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_like',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'edit_N0';

h54 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''edit_N0_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.613756613756614,...
'ListboxTop',0,...
'Position',[0.292857142857143 0.261904761904762 0.0392857142857143 0.025],...
'String',{  'Edit Text' },...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_N0_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_N0',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'popup_nbcovariates';

h55 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''popup_nbcovariates_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.560386473429952,...
'ListboxTop',0,...
'Max',10,...
'Min',1,...
'Position',[0.599107142857143 0.897619047619048 0.0410714285714286 0.0273809523809524],...
'Style','popupmenu',...
'Value',1,...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''popup_nbcovariates_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','popup_nbcovariates',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'text_nbcovariates';

h56 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.644444444444444,...
'HorizontalAlignment','right',...
'ListboxTop',0,...
'Position',[0.445535714285714 0.898809523809524 0.15 0.0238095238095238],...
'String','Number of covariates:',...
'Style','text',...
'Tag','text_nbcovariates',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'popup_nbparam';

h57 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''popup_nbparam_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.560386473429952,...
'ListboxTop',0,...
'Max',10,...
'Min',1,...
'Position',[0.789285714285714 0.897619047619048 0.0410714285714286 0.0273809523809524],...
'Style','popupmenu',...
'Value',1,...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''popup_nbparam_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','popup_nbparam',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'text_nbparam';

h58 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.644444444444444,...
'HorizontalAlignment','right',...
'ListboxTop',0,...
'Position',[0.6375 0.898809523809524 0.15 0.0238095238095238],...
'String','Number of indiv. param.:',...
'Style','text',...
'Tag','text_nbparam',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'frame8';

h59 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.588235294117647 0.796078431372549 0.796078431372549],...
'CData',[],...
'FontName','default',...
'FontSize',0.0658436213991769,...
'ForegroundColor',[0.5 0 0.25],...
'ListboxTop',0,...
'Position',[0.879464285714286 0.205952380952381 0.0982142857142857 0.161904761904762],...
'String',{  '' },...
'Style','frame',...
'Tag','frame8',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton_results';

h60 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_results_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontSize',0.4,...
'ListboxTop',0,...
'Position',[0.885 0.224 0.0875 0.039],...
'String','The results',...
'Tag','pushbutton_results',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_results';

h61 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.588235294117647 0.796078431372549 0.796078431372549],...
'CData',[],...
'FontName','default',...
'FontSize',0.859259259259259,...
'FontWeight','bold',...
'ListboxTop',0,...
'Position',[0.884821428571429 0.332142857142857 0.0892857142857143 0.0178571428571429],...
'String','FIGURES',...
'Style','text',...
'Tag','text_results',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text13';

h62 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.8,...
'FontWeight','bold',...
'ForegroundColor',[0.5 0.25 0],...
'ListboxTop',0,...
'Position',[0.366964285714286 0.95 0.149107142857143 0.019047619047619],...
'String','THE DATA',...
'Style','text',...
'Tag','text13',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'edit_resfile';

h63 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''edit_resfile_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.5,...
'ListboxTop',0,...
'Position',[0.134821428571429 0.0380952380952381 0.125 0.0297619047619048],...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_resfile_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_resfile',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'pushbutton_resfile';

h64 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_resfile_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.5,...
'ListboxTop',0,...
'Position',[0.134821428571429 0.0630952380952381 0.125 0.0297619047619048],...
'String','Results file: ',...
'Tag','pushbutton_resfile',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton_dispdata';

h65 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_dispdata_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontSize',0.4,...
'ListboxTop',0,...
'Position',[0.885 0.28 0.0875 0.039],...
'String','The data',...
'Tag','pushbutton_dispdata',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'edit_simulfile';

h66 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''edit_simulfile_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.5,...
'ListboxTop',0,...
'Position',[0.639285714285714 0.0321428571428571 0.125 0.0297619047619048],...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_simulfile_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_simulfile',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'pushbutton_simulfile';

h67 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_simulfile_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.5,...
'ListboxTop',0,...
'Position',[0.639285714285714 0.0583333333333334 0.125 0.0297619047619048],...
'String','Simulated data file: ',...
'Tag','pushbutton_simulfile',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'frame13';

h68 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.588235294117647 0.796078431372549 0.796078431372549],...
'CData',[],...
'FontName','default',...
'FontSize',0.0658436213991769,...
'ForegroundColor',[0.5 0 0.25],...
'ListboxTop',0,...
'Position',[0.879464285714286 0.0761904761904762 0.0982142857142857 0.1],...
'String',{  '' },...
'Style','frame',...
'Tag','frame13',...
'UserData',[],...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_simul';

h69 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.588235294117647 0.796078431372549 0.796078431372549],...
'CData',[],...
'FontName','default',...
'FontSize',0.859259259259259,...
'FontWeight','bold',...
'ListboxTop',0,...
'Position',[0.884821428571429 0.144047619047619 0.0892857142857143 0.0178571428571429],...
'String','SIMULATION',...
'Style','text',...
'Tag','text_simul',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton_simul';

h70 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_simul_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontSize',0.4,...
'ListboxTop',0,...
'Position',[0.884821428571429 0.0928571428571429 0.0875 0.0392857142857143],...
'String','Data set',...
'Tag','pushbutton_simul',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton_varini';

h71 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'Callback','mainmlx(''pushbutton_varini_Callback'',gcbo,[],guidata(gcbo))',...
'FontSize',0.495726495726496,...
'Position',[0.67 0.4 0.15 0.03],...
'String','Compute initial variances',...
'Tag','pushbutton_varini',...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_niter2';

h72 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.755208333333333,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.520535714285714 0.21547619047619 0.0392857142857143 0.019047619047619],...
'String','m_2',...
'Style','text',...
'Tag','text_niter2',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'edit_niter2';

h73 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''edit_niter2_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.549242424242424,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.523214285714286 0.183 0.0348214285714286 0.026],...
'String',{  'Edit Text' },...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_niter2_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_niter2',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'text_minv';

h74 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.7,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.361607142857143 0.440476190476191 0.197321428571429 0.024],...
'String','Minimum variances of the r.e.',...
'Style','text',...
'Tag','text_minv',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'text_log';

h75 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.725,...
'ListboxTop',0,...
'Position',[0.64375 0.803571428571429 0.196428571428571 0.024],...
'String','Distribution of the r.e.',...
'Style','text',...
'Tag','text_log',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'radiobutton_var1';

h76 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'Callback','mainmlx(''radiobutton_var1_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.716049382716049,...
'ListboxTop',0,...
'Position',[0.377678571428571 0.0619047619047619 0.13 0.0214285714285714],...
'String','Display variances',...
'Style','radiobutton',...
'Tag','radiobutton_var1',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'radiobutton_var2';

h77 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'Callback','mainmlx(''radiobutton_var2_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.716049382716049,...
'ListboxTop',0,...
'Position',[0.377678571428571 0.0285714285714286 0.13 0.0214285714285714],...
'String','Display stand. dev.',...
'Style','radiobutton',...
'Tag','radiobutton_var2',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'edit_sa1';

h78 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''edit_sa1_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontSize',0.549242424242424,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.264285714285714 0.183 0.0392857142857143 0.026],...
'String',{  'Edit Text' },...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_sa1_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_sa1',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'checkbox_sa';

h79 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.83899998664856 0.83899998664856 0.83899998664856],...
'Callback','mainmlx(''checkbox_sa_Callback'',gcbo,[],guidata(gcbo))',...
'FontSize',0.678362573099415,...
'ForegroundColor',[0.25 0.5 0.5],...
'Position',[0.253571428571429 0.211904761904762 0.139285714285714 0.0226190476190476],...
'String','Simulated Annealing',...
'Style','checkbox',...
'Tag','checkbox_sa',...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'popup_nchain';

h80 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''popup_nchain_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontName','default',...
'FontSize',0.560386473429952,...
'ListboxTop',0,...
'Max',10,...
'Min',1,...
'Position',[0.53125 0.258333333333333 0.0392857142857143 0.0273809523809524],...
'Style','popupmenu',...
'Value',1,...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''popup_nchain_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','popup_nchain',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'text_sa1';

h81 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.755208333333333,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.233035714285714 0.185714285714286 0.0294642857142857 0.019047619047619],...
'String','tau',...
'Style','text',...
'Tag','text_sa1',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );

appdata = [];
appdata.lastValidTag = 'edit_sa2';

h82 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[1 1 1],...
'Callback','mainmlx(''edit_sa2_Callback'',gcbo,[],guidata(gcbo))',...
'CData',[],...
'FontSize',0.55,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.35 0.183 0.0375 0.026],...
'String','Edit Text',...
'Style','edit',...
'CreateFcn', {@local_CreateFcn, 'mainmlx(''edit_sa2_CreateFcn'',gcbo,[],guidata(gcbo))', appdata} ,...
'Tag','edit_sa2',...
'UserData',[],...
...
'Visible','off');

appdata = [];
appdata.lastValidTag = 'text_sa2';

h83 = uicontrol(...
'Parent',h1,...
'Units','normalized',...
'FontUnits','normalized',...
'BackgroundColor',[0.84 0.84 0.84],...
'CData',[],...
'FontName','default',...
'FontSize',0.75,...
'ForegroundColor',[0.25 0.5 0.5],...
'ListboxTop',0,...
'Position',[0.321428571428571 0.185714285714286 0.0294642857142857 0.019047619047619],...
'String','T_0',...
'Style','text',...
'Tag','text_sa2',...
'UserData',[],...
...
'Visible','off',...
'CreateFcn', {@local_CreateFcn, '', appdata} );


hsingleton = h1;


% --- Set application data first then calling the CreateFcn. 
function local_CreateFcn(hObject, eventdata, createfcn, appdata)

if ~isempty(appdata)
   names = fieldnames(appdata);
   for i=1:length(names)
       name = char(names(i));
       setappdata(hObject, name, getfield(appdata,name));
   end
end

if ~isempty(createfcn)
   eval(createfcn);
end


% --- Handles default GUIDE GUI creation and callback dispatch
function varargout = gui_mainfcn(gui_State, varargin)


%   GUI_MAINFCN provides these command line APIs for dealing with GUIs
%
%      MAINMLX, by itself, creates a new MAINMLX or raises the existing
%      singleton*.
%
%      H = MAINMLX returns the handle to a new MAINMLX or the handle to
%      the existing singleton*.
%
%      MAINMLX('CALLBACK',hObject,eventData,handles,...) calls the local
%      function named CALLBACK in MAINMLX.M with the given input arguments.
%
%      MAINMLX('Property','Value',...) creates a new MAINMLX or raises the
%      existing singleton*.  Starting from the left, property value pairs are
%      applied to the GUI before untitled_OpeningFunction gets called.  An
%      unrecognized property name or invalid value makes property application
%      stop.  All inputs are passed to untitled_OpeningFcn via varargin.
%
%      *See GUI Options on GUIDE's Tools menu.  Choose "GUI allows only one
%      instance to run (singleton)".

%   Copyright 1984-2004 The MathWorks, Inc.
%   $Revision: 1.4.6.8 $ $Date: 2004/04/15 00:06:57 $

gui_StateFields =  {'gui_Name'
                    'gui_Singleton'
                    'gui_OpeningFcn'
                    'gui_OutputFcn'
                    'gui_LayoutFcn'
                    'gui_Callback'};
gui_Mfile = '';
for i=1:length(gui_StateFields)
    if ~isfield(gui_State, gui_StateFields{i})
        error('Could not find field %s in the gui_State struct in GUI M-file %s', gui_StateFields{i}, gui_Mfile);        
    elseif isequal(gui_StateFields{i}, 'gui_Name')
        gui_Mfile = [gui_State.(gui_StateFields{i}), '.m'];
    end
end

numargin = length(varargin);

if numargin == 0
    % MAINMLX
    % create the GUI
    gui_Create = 1;
elseif isequal(ishandle(varargin{1}), 1) && ispc && iscom(varargin{1}) && isequal(varargin{1},gcbo)
    % MAINMLX(ACTIVEX,...)    
    vin{1} = gui_State.gui_Name;
    vin{2} = [get(varargin{1}.Peer, 'Tag'), '_', varargin{end}];
    vin{3} = varargin{1};
    vin{4} = varargin{end-1};
    vin{5} = guidata(varargin{1}.Peer);
    feval(vin{:});
    return;
elseif ischar(varargin{1}) && numargin>1 && isequal(ishandle(varargin{2}), 1)
    % MAINMLX('CALLBACK',hObject,eventData,handles,...)
    gui_Create = 0;
else
    % MAINMLX(...)
    % create the GUI and hand varargin to the openingfcn
    gui_Create = 1;
end

if gui_Create == 0
    varargin{1} = gui_State.gui_Callback;
    if nargout
        [varargout{1:nargout}] = feval(varargin{:});
    else
        feval(varargin{:});
    end
else
    if gui_State.gui_Singleton
        gui_SingletonOpt = 'reuse';
    else
        gui_SingletonOpt = 'new';
    end
    
    % Open fig file with stored settings.  Note: This executes all component
    % specific CreateFunctions with an empty HANDLES structure.
    
    % Do feval on layout code in m-file if it exists
    if ~isempty(gui_State.gui_LayoutFcn)
        gui_hFigure = feval(gui_State.gui_LayoutFcn, gui_SingletonOpt);
        % openfig (called by local_openfig below) does this for guis without
        % the LayoutFcn. Be sure to do it here so guis show up on screen.
        movegui(gui_hFigure,'onscreen')
    else
        gui_hFigure = local_openfig(gui_State.gui_Name, gui_SingletonOpt);            
        % If the figure has InGUIInitialization it was not completely created
        % on the last pass.  Delete this handle and try again.
        if isappdata(gui_hFigure, 'InGUIInitialization')
            delete(gui_hFigure);
            gui_hFigure = local_openfig(gui_State.gui_Name, gui_SingletonOpt);            
        end
    end
    
    % Set flag to indicate starting GUI initialization
    setappdata(gui_hFigure,'InGUIInitialization',1);

    % Fetch GUIDE Application options
    gui_Options = getappdata(gui_hFigure,'GUIDEOptions');
    
    if ~isappdata(gui_hFigure,'GUIOnScreen')
        % Adjust background color
        if gui_Options.syscolorfig 
            set(gui_hFigure,'Color', get(0,'DefaultUicontrolBackgroundColor'));
        end

        % Generate HANDLES structure and store with GUIDATA
        guidata(gui_hFigure, guihandles(gui_hFigure));
    end
    
    % If user specified 'Visible','off' in p/v pairs, don't make the figure
    % visible.
    gui_MakeVisible = 1;
    for ind=1:2:length(varargin)
        if length(varargin) == ind
            break;
        end
        len1 = min(length('visible'),length(varargin{ind}));
        len2 = min(length('off'),length(varargin{ind+1}));
        if ischar(varargin{ind}) && ischar(varargin{ind+1}) && ...
                strncmpi(varargin{ind},'visible',len1) && len2 > 1
            if strncmpi(varargin{ind+1},'off',len2)
                gui_MakeVisible = 0;
            elseif strncmpi(varargin{ind+1},'on',len2)
                gui_MakeVisible = 1;
            end
        end
    end
    
    % Check for figure param value pairs
    for index=1:2:length(varargin)
        if length(varargin) == index
            break;
        end
        try set(gui_hFigure, varargin{index}, varargin{index+1}), catch break, end
    end

    % If handle visibility is set to 'callback', turn it on until finished
    % with OpeningFcn
    gui_HandleVisibility = get(gui_hFigure,'HandleVisibility');
    if strcmp(gui_HandleVisibility, 'callback')
        set(gui_hFigure,'HandleVisibility', 'on');
    end
    
    feval(gui_State.gui_OpeningFcn, gui_hFigure, [], guidata(gui_hFigure), varargin{:});
    
    if ishandle(gui_hFigure)
        % Update handle visibility
        set(gui_hFigure,'HandleVisibility', gui_HandleVisibility);
        
        % Make figure visible
        if gui_MakeVisible
            set(gui_hFigure, 'Visible', 'on')
            if gui_Options.singleton 
                setappdata(gui_hFigure,'GUIOnScreen', 1);
            end
        end

        % Done with GUI initialization
        rmappdata(gui_hFigure,'InGUIInitialization');
    end
    
    % If handle visibility is set to 'callback', turn it on until finished with
    % OutputFcn
    if ishandle(gui_hFigure)
        gui_HandleVisibility = get(gui_hFigure,'HandleVisibility');
        if strcmp(gui_HandleVisibility, 'callback')
            set(gui_hFigure,'HandleVisibility', 'on');
        end
        gui_Handles = guidata(gui_hFigure);
    else
        gui_Handles = [];
    end
    
    if nargout
        [varargout{1:nargout}] = feval(gui_State.gui_OutputFcn, gui_hFigure, [], gui_Handles);
    else
        feval(gui_State.gui_OutputFcn, gui_hFigure, [], gui_Handles);
    end
    
    if ishandle(gui_hFigure)
        set(gui_hFigure,'HandleVisibility', gui_HandleVisibility);
    end
end    

function gui_hFigure = local_openfig(name, singleton)

% openfig with three arguments was new from R13. Try to call that first, if
% failed, try the old openfig.
try 
    gui_hFigure = openfig(name, singleton, 'auto');
catch
    % OPENFIG did not accept 3rd input argument until R13,
    % toggle default figure visible to prevent the figure
    % from showing up too soon.
    gui_OldDefaultVisible = get(0,'defaultFigureVisible');
    set(0,'defaultFigureVisible','off');
    gui_hFigure = openfig(name, singleton);
    set(0,'defaultFigureVisible',gui_OldDefaultVisible);
end


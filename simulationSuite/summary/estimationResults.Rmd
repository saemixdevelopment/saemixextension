---
title: "Simulation suite - comparing results"
author: "Emmanuelle Comets"
date: '13/09/2022'
output:
  pdf_document: default
  html_document: default
  header-includes:
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{amsthm}
  - \usepackage{amsmath}
  - \usepackage{amsfonts}
  - \usepackage{amscd}
  - \usepackage{amssymb}
---

# Context

## Objective

Set up a simulation suite to evaluate new versions of saemix (ideally: run before every release)

- create sets of simulated data for the different types of models
  - currently: only continuous
  - **TODO**: other types of data
- run this file and save the results to a file simulationSuite_versionX.X.pdf
  - create a script to run the series of estimations on the cluster
  - create a script to extract the results for a given version of the code 
  - use the current script to create the pdf with tables and figures
  
**TODO** clarify the sequences and create clean scripts to facilitate the comparisons.

## Data overview and current progress

- Continuous data
  - PD response: Emax and Hill models for dose-response data (simulated in Comets et al., *Pharm Res* 2021), sigmoid Imax model (simulated in Plan et al. *JPKPD* 2012)
- Discrete data **TODO**
  - binary data: simulation based on toenail data (paper saemix 3)
  - count data: simulation based on the count data demo from Monolix with an added risk effect (Lucie, paper saemix 3)
  - categorical data: original simulation in Jonsson et al. *JPKPD* 2004, used as a basis by Savic et al. *JPKPD* 2010 **TODO**
- Time-to-event data **TODO**
  - inspiration from simulations performed by Alexandra ? (TTE, competitive risks)
  - also need RTTE

## Setup

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Folders
workDir<-"/home/eco/work/saemix/saemixextension/simulationSuite"
setwd(workDir)

# Libraries
library(xtable)
library(ggplot2)
library(tidyverse)
library(RColorBrewer)
library("viridis")  
# library(simhelpers)

saveFigs<-TRUE
```

## Computational functions

Note to self: bias=mean(estimation errors)

- summary statistics
  - sample mean: $$\bar{\theta} =  \frac{1}{K} \sum_k \hat{\theta}_k$$
  - sample variance $$S^2_{\theta} = var(\hat{\theta}-\bar{\theta}) = \frac{1}{K-1} \sum_k (\hat{\theta}_k-\bar{\theta})^2 $$ 
- absolute metrics
  - absolute bias
    - defined as the difference $$E(\hat{\theta})-\theta_0$$
    - estimated as $$\bar{\theta} -\theta_0$$
  - precision
    - defined as the variance of the estimates$$E \left( (\theta-E(\theta) \right)^2$$
    - estimated as $$S^2_{\theta}$$
  - accuracy (MSE)
    - defined as $$MSE=E((\theta-\theta_0)^2 )$$
    - estimated as $$ \frac{1}{K} \sum_k (\hat{\theta}_k-\bar{\theta})^2 $$ 
    - RMSE: square root of MSE $$RMSE = \sqrt{MSE}$$
- relative Bias
  - defined as the relative difference from true parameter in simhelpers $$E(\hat{\theta})/\theta$$
    - estimated as $$mean(\hat{\theta})/\theta_0$$
    - should be close to 1
  - here, we define it as the relative difference from true parameter minus 1 $$E(\hat{\theta}-\theta)/\theta$$
    - estimated as $$mean(\hat{\theta}-\theta_0)/\theta_0$$
    - should be close to 0
- relative MSE
  - accuracy in relative terms
  - defined as $$E((\hat{\theta}- \theta)^2)/\theta^2$$
  - **approximated** as $$\left( (\bar{\theta} -\theta_0)^2 + S^2_{\theta} \right)/\theta^2_0$$ 
  - take square root to obtain the relative RMSE 

Note **TODO**: install simhelpers package for computation of these metrics + the MC error

```{r evaluation, echo=FALSE}
computeBias <- function(parestim, truepar) {
  if(dim(parestim)[2] != length(truepar)) {
    cat('Dimension mismatch\n')
    return()
  }
  rrmse <- empSE<-mse<-bias<-rbias<- precision <- c()
  for(i in 1:length(truepar)) {
    varest <- var(parestim[,i]-truepar[i])
    empSE<-c(empSE, sqrt(varest))
    bias<-c(bias,mean(parestim[,i]-truepar[i]))
    mse<-c(mse,mean((parestim[,i]-truepar[i])**2))
    # precision
    precision <- c(precision, varest)
    rbias<-c(rbias,mean((parestim[,i]-truepar[i])/truepar[i]))
    rmse <- ((mean(parestim[,i])-truepar[i])**2 + varest)/(truepar[i])**2
    rrmse <- c(rrmse, rmse)
  }
  resbias<-data.frame(param=colnames(parestim), bias=bias, relativeBias=rbias, mse=mse, empSE = empSE, rrmse=rrmse, precision=precision)
  return(resbias)
}

computeREE <- function(parestim, truepar) {
  if(dim(parestim)[2] != length(truepar)) {
    cat('Dimension mismatch\n')
    return()
  }
  tab<-parestim
  for(i in 1:length(truepar)) {
    parestim[,i]<-100*(parestim[,i]-truepar[i])/truepar[i]
  }
  return(parestim)
}

```

# Continuous data

## Emax and Hill models

Data was simulated according to an Emax model or a Hill model (the first N=100 simulated datasets from the 200 simulated for the Pharm Res paper).

### Settings

```{r hillSettings}
dataType <- "cont"
parpop<-c(5,30,500,3)
nampar<-c("E0","Emax","ED50","gamma")
omega<-diag(c(0.09,0.49,0.49))
omega[3,2]<-omega[2,3]<-0.245
respar<-c(0.1)
```

### Simulation results

#### Version 3.1 on CRAN

```{r versionSettings31}
runDate <- '220913'
who <- "eco"
saemixVersion <-"cran31"
exampleName <- "doseResponsePlanProp"
runSettings <- c("defaultTrue","defaultFalse","longFalse")
runScenarios <- c("emaxRichProp","emaxSparseProp","hillRichProp","hillSparseProp")
```

```{r readParameterEstimates31, echo=FALSE}
# Loop over scenarios
fullres <- fullresrel<-ygpl<-fullrelSE<-NULL
for(iscen in 1:4) {
  scenario<-runScenarios[iscen]
  if(length(grep('emax',scenario))==0) 
    pvrai<- c(parpop, respar, diag(omega), omega[2,3]) else
      pvrai <- c(parpop[1:3], respar, diag(omega), omega[2,3])
    npar<-length(pvrai)
    fullres1 <- fullresrel1 <-fullrelSE1<-NULL
    # Loop over settings
    for(iset in 1:3) {
      namRes <-paste0(runDate,"_",who,"_",saemixVersion,"_",scenario,"_",runSettings[iset],".res")
      estpar <- read.table(file.path(workDir, dataType, scenario,"results", namRes), header=T)
      resbias <- computeBias(estpar[,2:(1+npar)], pvrai)
      if(iset==1) {
        tabres <- fullres1 <- fullresrel1<-data.frame(param=resbias[,1], true=pvrai)
        fullrelSE1 <- data.frame(param=resbias[,1], empSE=resbias$empSE)
      }
      tabres<-cbind(tabres, bias=resbias[,2], rmse=sqrt(resbias[,4]))
      fullres1<-cbind(fullres1, bias=resbias$bias, rmse=sqrt(resbias$mse), precision=sqrt(resbias$precision))
      fullresrel1<-cbind(fullresrel1,bias=resbias$relativeBias*100, rrmse=resbias$rrmse*100)
      resbiasSE<-computeBias(estpar[,(4+npar):(2*npar+3)], resbias$empSE)
      fullrelSE1<-cbind(fullrelSE1,bias=resbiasSE$relativeBias*100, rrmse=resbiasSE$rrmse*100)
      
      tabree<-computeREE(estpar[,2:(1+npar)], pvrai)
      tabgpl <- tabree %>%
        pivot_longer( everything()) %>%
        mutate(setting=runSettings[iset], scenario=scenario)
      ygpl <- rbind(ygpl, tabgpl)
    }
    # Print results of bias and RMSE for the scenario
#    cat("Results for scenario", scenario,"\n")
#    cat("                   ", paste(runSettings,collapse="                           "),"\n")
#    print(tabres)
    l1<-fullres1[1,]
    l1[1]<-scenario
    l1[2:dim(fullres1)[2]]<-NA
    fullres<-rbind(fullres,l1,fullres1)
    l1<-fullresrel1[1,]
    l1[1]<-scenario
    l1[2:dim(fullresrel1)[2]]<-NA
    fullresrel<-rbind(fullresrel,l1,fullresrel1)
    l1<-fullrelSE1[1,]
    l1[1]<-scenario
    l1[2:dim(fullrelSE1)[2]]<-NA
    fullrelSE<-rbind(fullrelSE,l1,fullrelSE1)
    }

ygpl$name <- factor(ygpl$name,levels=unique(ygpl$name))
ygpl$setting <- factor(ygpl$setting,levels=unique(ygpl$setting))
ygpl$scenario <- factor(ygpl$scenario,levels=unique(ygpl$scenario))

# Would like to include the linetypes but not working, TBC
plot1 <- ggplot(ygpl, aes(name, value,colour=factor(setting),fill=factor(setting))) + geom_boxplot(alpha=0.5) + 
  geom_hline(yintercept = 0, alpha=0.5) + 
  geom_hline(yintercept = -10, alpha=0.3, linetype='dashed') + geom_hline(yintercept = 10, alpha=0.3, linetype='dashed') + 
  geom_hline(yintercept = -50, alpha=0.3, linetype='dotted') + geom_hline(yintercept = 50, alpha=0.3, linetype='dotted') + 
  xlab("Parameter") + ylab("Estimation error (%)") + theme_minimal() + scale_color_viridis(discrete=TRUE) + scale_fill_viridis(discrete=TRUE) + 
  scale_linetype_manual(name = "Bias", values = c("within 10%"="dashed","within 50%"="solid")) + 
  theme(legend.position = "right", axis.text.x = element_text(angle = 30)) + labs(fill = "Settings", linetype="Bias") + 
  guides(colour = "none", linetype = guide_legend(order = 2)) +
  facet_wrap(.~scenario, nrow=2) 

print(plot1)

if(saveFigs) {
  namFig <- paste0(runDate,"_",who,"_",saemixVersion,"_",exampleName,".eps")
  cairo_ps(file = file.path(workDir, "figs", namFig), onefile = TRUE, fallback_resolution = 600, height=8.27, width=11.69)
  plot(plot1)
  dev.off()
}

```
Bias and accuracy of the estimates in the different settings and scenarios

```{r biasTables31, results='asis', echo=FALSE, message=FALSE, warning=FALSE}
# Making xtables
# l1<-fullres[1,] # doesn't work, we lose the formatting...
# l1[1]<-c("")
# l1[c(3,6,9)]<-runSettings
# fullres<-rbind(l1,fullres)
xtab1<-xtable(fullres, caption=paste0("Bias, precision and accurary in the example ",exampleName," for settings:",paste(runSettings, collapse=', ')), digits=2, nsmall=2)
xtab1
# print(xtab1, include.rownames=FALSE, comment=FALSE)

# l1<-fullresrel[1,]
# l1[1]<-c("")
# l1[c(3,5,7)]<-runSettings
# fullresrel<-rbind(l1,fullresrel)
xtab2 <- xtable(fullresrel, caption=paste0("Relative bias and relative RMSE (in %) in the example ",exampleName," for settings:",paste(runSettings, collapse=', ')), digits=2, nsmall=2)
xtab2
# print(xtab2, include.rownames=FALSE, comment=FALSE)

xtab3 <- xtable(fullrelSE, caption=paste0("Relative bias and relative RMSE (in %) on SE estimated by linearisation, compared to the empirical SE, in the example ",exampleName," for settings:",paste(runSettings, collapse=', ')), digits=2, nsmall=2)
xtab3

```


#### Tweaking the algorithm

Keeping the IIV active until the end of the K1 first iterations instead of setting them to 0 at the end of the SA part of the algorithm

Results are clearly worse, both for random effects (biased variances) and even for some fixed effects ($\gamma$ in the sparse Hill design, but also ED50 and Emax that already showed 10% bias, now increased to 20%).

```{r versionSettingsTweakSA}
runDate <- '220914'
who <- "eco"
saemixVersion <-"tweakSA"
exampleName <- "doseResponsePlanProp"
runSettings <- c("defaultTrue","defaultFalse","longFalse")
runScenarios <- c("emaxRichProp","emaxSparseProp","hillRichProp","hillSparseProp")
```



```{r readParameterEstimatesTweakSA, echo=FALSE}
# Loop over scenarios
fullres <- fullresrel<-ygpl<-fullrelSE<-NULL
for(iscen in 1:4) {
  scenario<-runScenarios[iscen]
  if(length(grep('emax',scenario))==0) 
    pvrai<- c(parpop, respar, diag(omega), omega[2,3]) else
      pvrai <- c(parpop[1:3], respar, diag(omega), omega[2,3])
    npar<-length(pvrai)
    fullres1 <- fullresrel1 <-fullrelSE1<-NULL
    # Loop over settings
    for(iset in 1:3) {
      namRes <-paste0(runDate,"_",who,"_",saemixVersion,"_",scenario,"_",runSettings[iset],".res")
      estpar <- read.table(file.path(workDir, dataType, scenario,"results", namRes), header=T)
      resbias <- computeBias(estpar[,2:(1+npar)], pvrai)
      if(iset==1) {
        tabres <- fullres1 <- fullresrel1<-data.frame(param=resbias[,1], true=pvrai)
        fullrelSE1 <- data.frame(param=resbias[,1], empSE=resbias$empSE)
      }
      tabres<-cbind(tabres, bias=resbias[,2], rmse=sqrt(resbias[,4]))
      fullres1<-cbind(fullres1, bias=resbias$bias, rmse=sqrt(resbias$mse), precision=sqrt(resbias$precision))
      fullresrel1<-cbind(fullresrel1,bias=resbias$relativeBias*100, rrmse=resbias$rrmse*100)
      resbiasSE<-computeBias(estpar[,(4+npar):(2*npar+3)], resbias$empSE)
      fullrelSE1<-cbind(fullrelSE1,bias=resbiasSE$relativeBias*100, rrmse=resbiasSE$rrmse*100)
      
      tabree<-computeREE(estpar[,2:(1+npar)], pvrai)
      tabgpl <- tabree %>%
        pivot_longer( everything()) %>%
        mutate(setting=runSettings[iset], scenario=scenario)
      ygpl <- rbind(ygpl, tabgpl)
    }
    # Print results of bias and RMSE for the scenario
#    cat("Results for scenario", scenario,"\n")
#    cat("                   ", paste(runSettings,collapse="                           "),"\n")
#    print(tabres)
    l1<-fullres1[1,]
    l1[1]<-scenario
    l1[2:dim(fullres1)[2]]<-NA
    fullres<-rbind(fullres,l1,fullres1)
    l1<-fullresrel1[1,]
    l1[1]<-scenario
    l1[2:dim(fullresrel1)[2]]<-NA
    fullresrel<-rbind(fullresrel,l1,fullresrel1)
    l1<-fullrelSE1[1,]
    l1[1]<-scenario
    l1[2:dim(fullrelSE1)[2]]<-NA
    fullrelSE<-rbind(fullrelSE,l1,fullrelSE1)
    }

ygpl$name <- factor(ygpl$name,levels=unique(ygpl$name))
ygpl$setting <- factor(ygpl$setting,levels=unique(ygpl$setting))
ygpl$scenario <- factor(ygpl$scenario,levels=unique(ygpl$scenario))

# Would like to include the linetypes but not working, TBC
plot1 <- ggplot(ygpl, aes(name, value,colour=factor(setting),fill=factor(setting))) + geom_boxplot(alpha=0.5) + 
  geom_hline(yintercept = 0, alpha=0.5) + 
  geom_hline(yintercept = -10, alpha=0.3, linetype='dashed') + geom_hline(yintercept = 10, alpha=0.3, linetype='dashed') + 
  geom_hline(yintercept = -50, alpha=0.3, linetype='dotted') + geom_hline(yintercept = 50, alpha=0.3, linetype='dotted') + 
  xlab("Parameter") + ylab("Estimation error (%)") + theme_minimal() + scale_color_viridis(discrete=TRUE) + scale_fill_viridis(discrete=TRUE) + 
  scale_linetype_manual(name = "Bias", values = c("within 10%"="dashed","within 50%"="solid")) + 
  theme(legend.position = "right", axis.text.x = element_text(angle = 30)) + labs(fill = "Settings", linetype="Bias") + 
  guides(colour = "none", linetype = guide_legend(order = 2)) +
  facet_wrap(.~scenario, nrow=2) 

print(plot1)

if(saveFigs) {
  namFig <- paste0(runDate,"_",who,"_",saemixVersion,"_",exampleName,".eps")
  cairo_ps(file = file.path(workDir, "figs", namFig), onefile = TRUE, fallback_resolution = 600, height=8.27, width=11.69)
  plot(plot1)
  dev.off()
}

```
Bias and accuracy of the estimates in the different settings and scenarios

```{r biasTablesTweakSA, results='asis', echo=FALSE, message=FALSE, warning=FALSE}
# Making xtables
# l1<-fullres[1,] # doesn't work, we lose the formatting...
# l1[1]<-c("")
# l1[c(3,6,9)]<-runSettings
# fullres<-rbind(l1,fullres)
xtab1<-xtable(fullres, caption=paste0("Bias, precision and accurary in the example ",exampleName," for settings:",paste(runSettings, collapse=', ')), digits=2, nsmall=2)
xtab1
# print(xtab1, include.rownames=FALSE, comment=FALSE)

# l1<-fullresrel[1,]
# l1[1]<-c("")
# l1[c(3,5,7)]<-runSettings
# fullresrel<-rbind(l1,fullresrel)
xtab2 <- xtable(fullresrel, caption=paste0("Relative bias and relative RMSE (in %) in the example ",exampleName," for settings:",paste(runSettings, collapse=', ')), digits=2, nsmall=2)
xtab2
# print(xtab2, include.rownames=FALSE, comment=FALSE)

xtab3 <- xtable(fullrelSE, caption=paste0("Relative bias and relative RMSE (in %) on SE estimated by linearisation, compared to the empirical SE, in the example ",exampleName," for settings:",paste(runSettings, collapse=', ')), digits=2, nsmall=2)
xtab3

```

## Imax sigmoid model

Data was simulated according to a sigmoid Emax Hill model

### Settings

```{r hillImaxSettings}
dataType <- "cont"
parpop<-c(100,0.7,500,2)
parcov<-(-0.5) # ED50=500 in group 0, 300 in group 1
nampar<-c("E0","Imax","ED50","gamma")
omega<-diag(c(0.01,0,0.09,0)) # 10% IIV on E0 and 30% IIV on ID50, no correlation
respar<-c(5,0.2) # additive and proportional error terms
```

### Simulation results

#### Version 3.1 on CRAN

```{r imaxSettings31}
runDate <- '220920'
who <- "eco"
saemixVersion <-"cran31"
exampleName <- "doseResponsePlanProp"
runSettings <- c("defaultTrue","defaultFalse","longFalse")
runSettings <- c("defaultTrue")
runScenarios <- c("imaxRichProp","imaxRichAdd","imaxRichComb")

# namsimdat<-"pdimax"
# settings: n=6, N=100, 2 groups

```

```{r readParameterEstimates31, echo=FALSE}
# Loop over scenarios
fullres <- fullresrel<-ygpl<-fullrelSE<-NULL
for(iscen in 1:length(runScenarios)) {
  scenario<-runScenarios[iscen]
  sigma<-respar
  if(length(grep("Add", scenario))>0) sigma<-respar[1]
  if(length(grep("Prop", scenario))>0) sigma<-respar[2]
  pvrai <- c(parpop[1:3], parcov, parpop[4], sigma, omega[1,1],omega[3,3])
  npar<-length(pvrai)
  fullres1 <- fullresrel1 <-fullrelSE1<-NULL
    # Loop over settings
    for(iset in 1:length(runSettings)) {
      namRes <-paste0(runDate,"_",who,"_",saemixVersion,"_",scenario,"_",runSettings[iset],".res")
      estpar <- read.table(file.path(workDir, dataType, scenario,"results", namRes), header=T)
      if(length(grep("Comb", scenario))>0) 
        estpar[,"b.1"] <- abs(estpar[,"b.1"])
      resbias <- computeBias(estpar[,2:(1+npar)], pvrai)
      if(iset==1) {
        tabres <- fullres1 <- fullresrel1<-data.frame(param=resbias[,1], true=pvrai)
        fullrelSE1 <- data.frame(param=resbias[,1], empSE=resbias$empSE)
      }
      tabres<-cbind(tabres, bias=resbias[,2], rmse=sqrt(resbias[,4]))
      fullres1<-cbind(fullres1, bias=resbias$bias, rmse=sqrt(resbias$mse), precision=sqrt(resbias$precision))
      fullresrel1<-cbind(fullresrel1,bias=resbias$relativeBias*100, rrmse=resbias$rrmse*100)
      resbiasSE<-computeBias(estpar[,(4+npar):(2*npar+3)], resbias$empSE)
      fullrelSE1<-cbind(fullrelSE1,bias=resbiasSE$relativeBias*100, rrmse=resbiasSE$rrmse*100)
      
      tabree<-computeREE(estpar[,2:(1+npar)], pvrai)
      tabgpl <- tabree %>%
        pivot_longer( everything()) %>%
        mutate(setting=runSettings[iset], scenario=scenario)
      ygpl <- rbind(ygpl, tabgpl)
    }
    # Print results of bias and RMSE for the scenario
#    cat("Results for scenario", scenario,"\n")
#    cat("                   ", paste(runSettings,collapse="                           "),"\n")
#    print(tabres)
    l1<-fullres1[1,]
    l1[1]<-scenario
    l1[2:dim(fullres1)[2]]<-NA
    fullres<-rbind(fullres,l1,fullres1)
    l1<-fullresrel1[1,]
    l1[1]<-scenario
    l1[2:dim(fullresrel1)[2]]<-NA
    fullresrel<-rbind(fullresrel,l1,fullresrel1)
    l1<-fullrelSE1[1,]
    l1[1]<-scenario
    l1[2:dim(fullrelSE1)[2]]<-NA
    fullrelSE<-rbind(fullrelSE,l1,fullrelSE1)
    }

ygpl$name <- factor(ygpl$name,levels=unique(ygpl$name))
ygpl$setting <- factor(ygpl$setting,levels=unique(ygpl$setting))
ygpl$scenario <- factor(ygpl$scenario,levels=unique(ygpl$scenario))

# Would like to include the linetypes but not working, TBC
plot1 <- ggplot(ygpl, aes(name, value,colour=factor(setting),fill=factor(setting))) + geom_boxplot(alpha=0.5) + 
  geom_hline(yintercept = 0, alpha=0.5) + 
  geom_hline(yintercept = -10, alpha=0.3, linetype='dashed') + geom_hline(yintercept = 10, alpha=0.3, linetype='dashed') + 
  geom_hline(yintercept = -50, alpha=0.3, linetype='dotted') + geom_hline(yintercept = 50, alpha=0.3, linetype='dotted') + 
  xlab("Parameter") + ylab("Estimation error (%)") + theme_minimal() + scale_color_viridis(discrete=TRUE) + scale_fill_viridis(discrete=TRUE) + 
  scale_linetype_manual(name = "Bias", values = c("within 10%"="dashed","within 50%"="solid")) + 
  theme(legend.position = "right", axis.text.x = element_text(angle = 30)) + labs(fill = "Settings", linetype="Bias") + 
  guides(colour = "none", linetype = guide_legend(order = 2)) +
  facet_wrap(.~scenario, nrow=2) 

print(plot1)

if(saveFigs) {
  namFig <- paste0(runDate,"_",who,"_",saemixVersion,"_",exampleName,".eps")
  cairo_ps(file = file.path(workDir, "figs", namFig), onefile = TRUE, fallback_resolution = 600, height=8.27, width=11.69)
  plot(plot1)
  dev.off()
}

```
Bias and accuracy of the estimates in the different settings and scenarios

```{r biasTables31, results='asis', echo=FALSE, message=FALSE, warning=FALSE}
# Making xtables
# l1<-fullres[1,] # doesn't work, we lose the formatting...
# l1[1]<-c("")
# l1[c(3,6,9)]<-runSettings
# fullres<-rbind(l1,fullres)
xtab1<-xtable(fullres, caption=paste0("Bias, precision and accurary in the example ",exampleName," for settings:",paste(runSettings, collapse=', ')), digits=2, nsmall=2)
xtab1
# print(xtab1, include.rownames=FALSE, comment=FALSE)

# l1<-fullresrel[1,]
# l1[1]<-c("")
# l1[c(3,5,7)]<-runSettings
# fullresrel<-rbind(l1,fullresrel)
xtab2 <- xtable(fullresrel, caption=paste0("Relative bias and relative RMSE (in %) in the example ",exampleName," for settings:",paste(runSettings, collapse=', ')), digits=2, nsmall=2)
xtab2
# print(xtab2, include.rownames=FALSE, comment=FALSE)

xtab3 <- xtable(fullrelSE, caption=paste0("Relative bias and relative RMSE (in %) on SE estimated by linearisation, compared to the empirical SE, in the example ",exampleName," for settings:",paste(runSettings, collapse=', ')), digits=2, nsmall=2)
xtab3

```
